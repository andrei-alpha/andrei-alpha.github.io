/*

 // Underscore.js 1.1.7
 // (c) 2011 Jeremy Ashkenas, DocumentCloud Inc.
 // Underscore is freely distributable under the MIT license.
 // Portions of Underscore are inspired or borrowed from Prototype,
 // Oliver Steele's Functional, and John Resig's Micro-Templating.
 // For all details and documentation:
 // http://documentcloud.github.com/underscore
*/
(function(){var q=this,F=q._,B={},o=Array.prototype,G=Object.prototype,y=o.slice,v=o.unshift,u=G.toString,f=G.hasOwnProperty,D=o.forEach,z=o.map,e=o.reduce,p=o.reduceRight,r=o.filter,C=o.every,d=o.some,j=o.indexOf,n=o.lastIndexOf;G=Array.isArray;var A=Object.keys,a=Function.prototype.bind,b=function(c){return new s(c)};typeof module!=="undefined"&&module.exports?(module.exports=b,b._=b):q._=b;b.VERSION="1.1.7";var m=b.each=b.forEach=function(c,i,l){if(c!=null)if(D&&c.forEach===D)c.forEach(i,l);else if(c.length===
+c.length)for(var w=0,E=c.length;w<E;w++){if(w in c&&i.call(l,c[w],w,c)===B)break}else for(w in c)if(f.call(c,w)&&i.call(l,c[w],w,c)===B)break};b.map=function(c,i,l){var w=[];if(c==null)return w;if(z&&c.map===z)return c.map(i,l);m(c,function(E,H,I){w[w.length]=i.call(l,E,H,I)});return w};b.reduce=b.foldl=b.inject=function(c,i,l,w){var E=l!==void 0;c==null&&(c=[]);if(e&&c.reduce===e)return w&&(i=b.bind(i,w)),E?c.reduce(i,l):c.reduce(i);m(c,function(H,I,M){E?l=i.call(w,l,H,I,M):(l=H,E=true)});if(!E)throw new TypeError("Reduce of empty array with no initial value");
return l};b.reduceRight=b.foldr=function(c,i,l,w){c==null&&(c=[]);if(p&&c.reduceRight===p)return w&&(i=b.bind(i,w)),l!==void 0?c.reduceRight(i,l):c.reduceRight(i);c=(b.isArray(c)?c.slice():b.toArray(c)).reverse();return b.reduce(c,i,l,w)};b.find=b.detect=function(c,i,l){var w;g(c,function(E,H,I){if(i.call(l,E,H,I))return w=E,true});return w};b.filter=b.select=function(c,i,l){var w=[];if(c==null)return w;if(r&&c.filter===r)return c.filter(i,l);m(c,function(E,H,I){i.call(l,E,H,I)&&(w[w.length]=E)});
return w};b.reject=function(c,i,l){var w=[];if(c==null)return w;m(c,function(E,H,I){i.call(l,E,H,I)||(w[w.length]=E)});return w};b.every=b.all=function(c,i,l){var w=true;if(c==null)return w;if(C&&c.every===C)return c.every(i,l);m(c,function(E,H,I){if(!(w=w&&i.call(l,E,H,I)))return B});return w};var g=b.some=b.any=function(c,i,l){i=i||b.identity;var w=false;if(c==null)return w;if(d&&c.some===d)return c.some(i,l);m(c,function(E,H,I){if(w|=i.call(l,E,H,I))return B});return!!w};b.include=b.contains=function(c,
i){var l=false;if(c==null)return l;if(j&&c.indexOf===j)return c.indexOf(i)!=-1;g(c,function(w){if(l=w===i)return true});return l};b.invoke=function(c,i){var l=y.call(arguments,2);return b.map(c,function(w){return(i.call?i||w:w[i]).apply(w,l)})};b.pluck=function(c,i){return b.map(c,function(l){return l[i]})};b.max=function(c,i,l){if(!i&&b.isArray(c))return Math.max.apply(Math,c);var w={computed:-Infinity};m(c,function(E,H,I){H=i?i.call(l,E,H,I):E;H>=w.computed&&(w={value:E,computed:H})});return w.value};
b.min=function(c,i,l){if(!i&&b.isArray(c))return Math.min.apply(Math,c);var w={computed:Infinity};m(c,function(E,H,I){H=i?i.call(l,E,H,I):E;H<w.computed&&(w={value:E,computed:H})});return w.value};b.sortBy=function(c,i,l){return b.pluck(b.map(c,function(w,E,H){return{value:w,criteria:i.call(l,w,E,H)}}).sort(function(w,E){var H=w.criteria,I=E.criteria;return H<I?-1:H>I?1:0}),"value")};b.groupBy=function(c,i){var l={};m(c,function(w,E){var H=i(w,E);(l[H]||(l[H]=[])).push(w)});return l};b.sortedIndex=
function(c,i,l){l||(l=b.identity);for(var w=0,E=c.length;w<E;){var H=w+E>>1;l(c[H])<l(i)?w=H+1:E=H}return w};b.toArray=function(c){if(!c)return[];if(c.toArray)return c.toArray();if(b.isArray(c))return y.call(c);if(b.isArguments(c))return y.call(c);return b.values(c)};b.size=function(c){return b.toArray(c).length};b.first=b.head=function(c,i,l){return i!=null&&!l?y.call(c,0,i):c[0]};b.rest=b.tail=function(c,i,l){return y.call(c,i==null||l?1:i)};b.last=function(c){return c[c.length-1]};b.compact=function(c){return b.filter(c,
function(i){return!!i})};b.flatten=function(c){return b.reduce(c,function(i,l){if(b.isArray(l))return i.concat(b.flatten(l));i[i.length]=l;return i},[])};b.without=function(c){return b.difference(c,y.call(arguments,1))};b.uniq=b.unique=function(c,i){return b.reduce(c,function(l,w,E){if(0==E||(i===true?b.last(l)!=w:!b.include(l,w)))l[l.length]=w;return l},[])};b.union=function(){return b.uniq(b.flatten(arguments))};b.intersection=b.intersect=function(c){var i=y.call(arguments,1);return b.filter(b.uniq(c),
function(l){return b.every(i,function(w){return b.indexOf(w,l)>=0})})};b.difference=function(c,i){return b.filter(c,function(l){return!b.include(i,l)})};b.zip=function(){for(var c=y.call(arguments),i=b.max(b.pluck(c,"length")),l=Array(i),w=0;w<i;w++)l[w]=b.pluck(c,""+w);return l};b.indexOf=function(c,i,l){if(c==null)return-1;var w;if(l)return l=b.sortedIndex(c,i),c[l]===i?l:-1;if(j&&c.indexOf===j)return c.indexOf(i);l=0;for(w=c.length;l<w;l++)if(c[l]===i)return l;return-1};b.lastIndexOf=function(c,
i){if(c==null)return-1;if(n&&c.lastIndexOf===n)return c.lastIndexOf(i);for(var l=c.length;l--;)if(c[l]===i)return l;return-1};b.range=function(c,i,l){arguments.length<=1&&(i=c||0,c=0);l=arguments[2]||1;for(var w=Math.max(Math.ceil((i-c)/l),0),E=0,H=Array(w);E<w;){H[E++]=c;c+=l}return H};b.bind=function(c,i){if(c.bind===a&&a)return a.apply(c,y.call(arguments,1));var l=y.call(arguments,2);return function(){return c.apply(i,l.concat(y.call(arguments)))}};b.bindAll=function(c){var i=y.call(arguments,
1);i.length==0&&(i=b.functions(c));m(i,function(l){c[l]=b.bind(c[l],c)});return c};b.memoize=function(c,i){var l={};i||(i=b.identity);return function(){var w=i.apply(this,arguments);return f.call(l,w)?l[w]:l[w]=c.apply(this,arguments)}};b.delay=function(c,i){var l=y.call(arguments,2);return setTimeout(function(){return c.apply(c,l)},i)};b.defer=function(c){return b.delay.apply(b,[c,1].concat(y.call(arguments,1)))};var k=function(c,i,l){var w;return function(){var E=this,H=arguments,I=function(){w=
null;c.apply(E,H)};l&&clearTimeout(w);if(l||!w)w=setTimeout(I,i)}};b.throttle=function(c,i){return k(c,i,false)};b.debounce=function(c,i){return k(c,i,true)};b.once=function(c){var i=false,l;return function(){if(i)return l;i=true;return l=c.apply(this,arguments)}};b.wrap=function(c,i){return function(){var l=[c].concat(y.call(arguments));return i.apply(this,l)}};b.compose=function(){var c=y.call(arguments);return function(){for(var i=y.call(arguments),l=c.length-1;l>=0;l--)i=[c[l].apply(this,i)];
return i[0]}};b.after=function(c,i){return function(){if(--c<1)return i.apply(this,arguments)}};b.keys=A||function(c){if(c!==Object(c))throw new TypeError("Invalid object");var i=[],l;for(l in c)f.call(c,l)&&(i[i.length]=l);return i};b.values=function(c){return b.map(c,b.identity)};b.functions=b.methods=function(c){var i=[],l;for(l in c)b.isFunction(c[l])&&i.push(l);return i.sort()};b.extend=function(c){m(y.call(arguments,1),function(i){for(var l in i)i[l]!==void 0&&(c[l]=i[l])});return c};b.defaults=
function(c){m(y.call(arguments,1),function(i){for(var l in i)c[l]==null&&(c[l]=i[l])});return c};b.clone=function(c){return b.isArray(c)?c.slice():b.extend({},c)};b.tap=function(c,i){i(c);return c};b.isEqual=function(c,i){if(c===i)return true;var l=typeof c;if(l!=typeof i)return false;if(c==i)return true;if(!c&&i||c&&!i)return false;if(c._chain)c=c._wrapped;if(i._chain)i=i._wrapped;if(c.isEqual)return c.isEqual(i);if(i.isEqual)return i.isEqual(c);if(b.isDate(c)&&b.isDate(i))return c.getTime()===i.getTime();
if(b.isNaN(c)&&b.isNaN(i))return false;if(b.isRegExp(c)&&b.isRegExp(i))return c.source===i.source&&c.global===i.global&&c.ignoreCase===i.ignoreCase&&c.multiline===i.multiline;if(l!=="object")return false;if(c.length&&c.length!==i.length)return false;l=b.keys(c);var w=b.keys(i);if(l.length!=w.length)return false;for(var E in c)if(!(E in i)||!b.isEqual(c[E],i[E]))return false;return true};b.isEmpty=function(c){if(b.isArray(c)||b.isString(c))return c.length===0;for(var i in c)if(f.call(c,i))return false;
return true};b.isElement=function(c){return!!(c&&c.nodeType==1)};b.isArray=G||function(c){return u.call(c)==="[object Array]"};b.isObject=function(c){return c===Object(c)};b.isArguments=function(c){return!(!c||!f.call(c,"callee"))};b.isFunction=function(c){return!(!c||!c.constructor||!c.call||!c.apply)};b.isString=function(c){return!!(c===""||c&&c.charCodeAt&&c.substr)};b.isNumber=function(c){return!!(c===0||c&&c.toExponential&&c.toFixed)};b.isNaN=function(c){return c!==c};b.isBoolean=function(c){return c===
true||c===false};b.isDate=function(c){return!(!c||!c.getTimezoneOffset||!c.setUTCFullYear)};b.isRegExp=function(c){return!(!c||!c.test||!c.exec||!(c.ignoreCase||c.ignoreCase===false))};b.isNull=function(c){return c===null};b.isUndefined=function(c){return c===void 0};b.noConflict=function(){q._=F;return this};b.identity=function(c){return c};b.times=function(c,i,l){for(var w=0;w<c;w++)i.call(l,w)};b.mixin=function(c){m(b.functions(c),function(i){x(i,b[i]=c[i])})};var h=0;b.uniqueId=function(c){var i=
h++;return c?c+i:i};b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g};b.template=function(c,i){var l=b.templateSettings;l="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+c.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(l.interpolate,function(w,E){return"',"+E.replace(/\\'/g,"'")+",'"}).replace(l.evaluate||null,function(w,E){return"');"+E.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,
"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');";l=new Function("obj",l);return i?l(i):l};var s=function(c){this._wrapped=c};b.prototype=s.prototype;var t=function(c,i){return i?b(c).chain():c},x=function(c,i){s.prototype[c]=function(){var l=y.call(arguments);v.call(l,this._wrapped);return t(i.apply(b,l),this._chain)}};b.mixin(b);m(["pop","push","reverse","shift","sort","splice","unshift"],function(c){var i=o[c];s.prototype[c]=function(){i.apply(this._wrapped,arguments);return t(this._wrapped,
this._chain)}});m(["concat","join","slice"],function(c){var i=o[c];s.prototype[c]=function(){return t(i.apply(this._wrapped,arguments),this._chain)}});s.prototype.chain=function(){this._chain=true;return this};s.prototype.value=function(){return this._wrapped}})();/*

 // Backbone.js 0.5.3
 // (c) 2010 Jeremy Ashkenas, DocumentCloud Inc.
 // Backbone may be freely distributed under the MIT license.
 // For all details and documentation:
 // http://documentcloud.github.com/backbone
*/
(function(){var q=this,F=q.Backbone,B;B=typeof exports!=="undefined"?exports:q.Backbone={};B.VERSION="0.5.3";var o=q._;if(!o&&typeof require!=="undefined")o=require("underscore")._;var G=q.jQuery||q.Zepto;B.noConflict=function(){q.Backbone=F;return this};B.emulateHTTP=false;B.emulateJSON=false;B.Events={bind:function(a,b,m){var g=this._callbacks||(this._callbacks={});(g[a]||(g[a]=[])).push([b,m]);return this},unbind:function(a,b){var m;if(a){if(m=this._callbacks)if(b){m=m[a];if(!m)return this;for(var g=
0,k=m.length;g<k;g++)if(m[g]&&b===m[g][0]){m[g]=null;break}}else m[a]=[]}else this._callbacks={};return this},trigger:function(a){var b,m,g,k,h=2;if(!(m=this._callbacks))return this;for(;h--;)if(b=h?a:"all",b=m[b])for(var s=0,t=b.length;s<t;s++)(g=b[s])?(k=h?Array.prototype.slice.call(arguments,1):arguments,g[0].apply(g[1]||this,k)):(b.splice(s,1),s--,t--);return this}};B.Model=function(a,b){var m;a||(a={});if(m=this.defaults){o.isFunction(m)&&(m=m.call(this));a=o.extend({},m,a)}this.attributes={};
this._escapedAttributes={};this.cid=o.uniqueId("c");this.set(a,{silent:true});this._changed=false;this._previousAttributes=o.clone(this.attributes);if(b&&b.collection)this.collection=b.collection;this.initialize(a,b)};o.extend(B.Model.prototype,B.Events,{_previousAttributes:null,_changed:false,idAttribute:"id",initialize:function(){},toJSON:function(){return o.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;b=this.attributes[a];
return this._escapedAttributes[a]=(b==null?"":""+b).replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},has:function(a){return this.attributes[a]!=null},set:function(a,b){b||(b={});if(!a)return this;if(a.attributes)a=a.attributes;var m=this.attributes,g=this._escapedAttributes;if(!b.silent&&this.validate&&!this._performValidation(a,b))return false;if(this.idAttribute in a)this.id=a[this.idAttribute];
var k=this._changing;this._changing=true;for(var h in a){var s=a[h];if(!o.isEqual(m[h],s)){m[h]=s;delete g[h];this._changed=true;b.silent||this.trigger("change:"+h,this,s,b)}}!k&&!b.silent&&this._changed&&this.change(b);this._changing=false;return this},unset:function(a,b){if(!(a in this.attributes))return this;b||(b={});var m={};m[a]=void 0;if(!b.silent&&this.validate&&!this._performValidation(m,b))return false;delete this.attributes[a];delete this._escapedAttributes[a];a==this.idAttribute&&delete this.id;
this._changed=true;b.silent||(this.trigger("change:"+a,this,void 0,b),this.change(b));return this},clear:function(a){a||(a={});var b,m=this.attributes,g={};for(b in m)g[b]=void 0;if(!a.silent&&this.validate&&!this._performValidation(g,a))return false;this.attributes={};this._escapedAttributes={};this._changed=true;if(!a.silent){for(b in m)this.trigger("change:"+b,this,void 0,a);this.change(a)}return this},fetch:function(a){a||(a={});var b=this,m=a.success;a.success=function(g,k,h){if(!b.set(b.parse(g,
h),a))return false;m&&m(b,g)};a.error=A(a.error,b,a);return(this.sync||B.sync).call(this,"read",this,a)},save:function(a,b){b||(b={});if(a&&!this.set(a,b))return false;var m=this,g=b.success;b.success=function(h,s,t){if(!m.set(m.parse(h,t),b))return false;g&&g(m,h,t)};b.error=A(b.error,m,b);var k=this.isNew()?"create":"update";return(this.sync||B.sync).call(this,k,this,b)},destroy:function(a){a||(a={});if(this.isNew())return this.trigger("destroy",this,this.collection,a);var b=this,m=a.success;a.success=
function(g){b.trigger("destroy",b,b.collection,a);m&&m(b,g)};a.error=A(a.error,b,a);return(this.sync||B.sync).call(this,"delete",this,a)},url:function(){var a=j(this.collection)||this.urlRoot||n();if(this.isNew())return a;return a+(a.charAt(a.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this)},isNew:function(){return this.id==null},change:function(a){this.trigger("change",this,a);this._previousAttributes=o.clone(this.attributes);
this._changed=false},hasChanged:function(a){if(a)return this._previousAttributes[a]!=this.attributes[a];return this._changed},changedAttributes:function(a){a||(a=this.attributes);var b=this._previousAttributes,m=false,g;for(g in a)o.isEqual(b[g],a[g])||(m=m||{},m[g]=a[g]);return m},previous:function(a){if(!a||!this._previousAttributes)return null;return this._previousAttributes[a]},previousAttributes:function(){return o.clone(this._previousAttributes)},_performValidation:function(a,b){var m=this.validate(a);
if(m)return b.error?b.error(this,m,b):this.trigger("error",this,m,b),false;return true}});B.Collection=function(a,b){b||(b={});if(b.comparator)this.comparator=b.comparator;o.bindAll(this,"_onModelEvent","_removeReference");this._reset();a&&this.reset(a,{silent:true});this.initialize.apply(this,arguments)};o.extend(B.Collection.prototype,B.Events,{model:B.Model,initialize:function(){},toJSON:function(){return this.map(function(a){return a.toJSON()})},add:function(a,b){if(o.isArray(a))for(var m=0,g=
a.length;m<g;m++)this._add(a[m],b);else this._add(a,b);return this},remove:function(a,b){if(o.isArray(a))for(var m=0,g=a.length;m<g;m++)this._remove(a[m],b);else this._remove(a,b);return this},get:function(a){if(a==null)return null;return this._byId[a.id!=null?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");this.models=this.sortBy(this.comparator);
a.silent||this.trigger("reset",this,a);return this},pluck:function(a){return o.map(this.models,function(b){return b.get(a)})},reset:function(a,b){a||(a=[]);b||(b={});this.each(this._removeReference);this._reset();this.add(a,{silent:true});b.silent||this.trigger("reset",this,b);return this},fetch:function(a){a||(a={});var b=this,m=a.success;a.success=function(g,k,h){b[a.add?"add":"reset"](b.parse(g,h),a);m&&m(b,g)};a.error=A(a.error,b,a);return(this.sync||B.sync).call(this,"read",this,a)},create:function(a,
b){var m=this;b||(b={});a=this._prepareModel(a,b);if(!a)return false;var g=b.success;b.success=function(k,h,s){m.add(k,b);g&&g(k,h,s)};a.save(null,b);return a},parse:function(a){return a},chain:function(){return o(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(a,b){if(a instanceof B.Model){if(!a.collection)a.collection=this}else{var m=a;a=new this.model(m,{collection:this});a.validate&&!a._performValidation(m,b)&&(a=false)}return a},
_add:function(a,b){b||(b={});a=this._prepareModel(a,b);if(!a)return false;var m=this.getByCid(a);if(m)throw Error(["Can't add the same model to a set twice",m.id]);this._byId[a.id]=a;this._byCid[a.cid]=a;this.models.splice(b.at!=null?b.at:this.comparator?this.sortedIndex(a,this.comparator):this.length,0,a);a.bind("all",this._onModelEvent);this.length++;b.silent||a.trigger("add",a,this,b);return a},_remove:function(a,b){b||(b={});a=this.getByCid(a)||this.get(a);if(!a)return null;delete this._byId[a.id];
delete this._byCid[a.cid];this.models.splice(this.indexOf(a),1);this.length--;b.silent||a.trigger("remove",a,this,b);this._removeReference(a);return a},_removeReference:function(a){this==a.collection&&delete a.collection;a.unbind("all",this._onModelEvent)},_onModelEvent:function(a,b,m,g){(a=="add"||a=="remove")&&m!=this||(a=="destroy"&&this._remove(b,g),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,arguments))}});o.each(["forEach",
"each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","rest","last","without","indexOf","lastIndexOf","isEmpty","groupBy"],function(a){B.Collection.prototype[a]=function(){return o[a].apply(o,[this.models].concat(o.toArray(arguments)))}});B.Router=function(a){a||(a={});if(a.routes)this.routes=a.routes;this._bindRoutes();this.initialize.apply(this,arguments)};
var y=/:([\w\d]+)/g,v=/\*([\w\d]+)/g,u=/[-[\]{}()+?.,\\^$|#\s]/g;o.extend(B.Router.prototype,B.Events,{initialize:function(){},route:function(a,b,m){B.history||(B.history=new B.History);o.isRegExp(a)||(a=this._routeToRegExp(a));B.history.route(a,o.bind(function(g){g=this._extractParameters(a,g);m.apply(this,g);this.trigger.apply(this,["route:"+b].concat(g))},this))},navigate:function(a,b){B.history.navigate(a,b)},_bindRoutes:function(){if(this.routes){var a=[],b;for(b in this.routes)a.unshift([b,
this.routes[b]]);b=0;for(var m=a.length;b<m;b++)this.route(a[b][0],a[b][1],this[a[b][1]])}},_routeToRegExp:function(a){a=a.replace(u,"\\$&").replace(y,"([^/]*)").replace(v,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});B.History=function(){this.handlers=[];o.bindAll(this,"checkUrl")};var f=/^#*/,D=/msie [\w.]+/,z=false;o.extend(B.History.prototype,{interval:50,getFragment:function(a,b){if(a==null)if(this._hasPushState||b){a=window.location.pathname;
var m=window.location.search;m&&(a+=m);a.indexOf(this.options.root)==0&&(a=a.substr(this.options.root.length))}else a=window.location.hash;return decodeURIComponent(a.replace(f,""))},start:function(a){if(z)throw Error("Backbone.history has already been started");this.options=o.extend({},{root:"/"},this.options,a);this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);a=this.getFragment();var b=document.documentMode;if(b=
D.exec(navigator.userAgent.toLowerCase())&&(!b||b<=7)){this.iframe=G('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(a)}this._hasPushState?G(window).bind("popstate",this.checkUrl):"onhashchange"in window&&!b?G(window).bind("hashchange",this.checkUrl):setInterval(this.checkUrl,this.interval);this.fragment=a;z=true;a=window.location;b=a.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,
true),window.location.replace(this.options.root+"#"+this.fragment),true;else if(this._wantsPushState&&this._hasPushState&&b&&a.hash){this.fragment=a.hash.replace(f,"");window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment)}if(!this.options.silent)return this.loadUrl()},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a==this.fragment&&this.iframe&&(a=this.getFragment(this.iframe.location.hash));
if(a==this.fragment||a==decodeURIComponent(this.fragment))return false;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return o.any(this.handlers,function(m){if(m.route.test(b))return m.callback(b),true})},navigate:function(a,b){var m=(a||"").replace(f,"");if(!(this.fragment==m||this.fragment==decodeURIComponent(m))){if(this._hasPushState){var g=window.location;m.indexOf(this.options.root)!=0&&(m=this.options.root+
m);this.fragment=m;window.history.pushState({},document.title,g.protocol+"//"+g.host+m)}else if(window.location.hash=this.fragment=m,this.iframe&&m!=this.getFragment(this.iframe.location.hash)){this.iframe.document.open().close();this.iframe.location.hash=m}b&&this.loadUrl(a)}}});B.View=function(a){this.cid=o.uniqueId("view");this._configure(a||{});this._ensureElement();this.delegateEvents();this.initialize.apply(this,arguments)};var e=/^(\S+)\s*(.*)$/,p=["model","collection","el","id","attributes",
"className","tagName"];o.extend(B.View.prototype,B.Events,{tagName:"div",$:function(a){return G(a,this.el)},initialize:function(){},render:function(){return this},remove:function(){G(this.el).remove();return this},make:function(a,b,m){a=document.createElement(a);b&&G(a).attr(b);m&&G(a).html(m);return a},delegateEvents:function(a){if(a||(a=this.events))for(var b in o.isFunction(a)&&(a=a.call(this)),G(this.el).unbind(".delegateEvents"+this.cid),a){var m=this[a[b]];if(!m)throw Error('Event "'+a[b]+'" does not exist');
var g=b.match(e),k=g[1];g=g[2];m=o.bind(m,this);k+=".delegateEvents"+this.cid;g===""?G(this.el).bind(k,m):G(this.el).delegate(g,k,m)}},_configure:function(a){this.options&&(a=o.extend({},this.options,a));for(var b=0,m=p.length;b<m;b++){var g=p[b];a[g]&&(this[g]=a[g])}this.options=a},_ensureElement:function(){if(this.el){if(o.isString(this.el))this.el=G(this.el).get(0)}else{var a=this.attributes||{};if(this.id)a.id=this.id;if(this.className)a["class"]=this.className;this.el=this.make(this.tagName,
a)}}});B.Model.extend=B.Collection.extend=B.Router.extend=B.View.extend=function(a,b){var m=d(this,a,b);m.extend=this.extend;return m};var r={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};B.sync=function(a,b,m){var g=r[a];m=o.extend({type:g,dataType:"json"},m);if(!m.url)m.url=j(b)||n();if(!m.data&&b&&(a=="create"||a=="update")){m.contentType="application/json";m.data=JSON.stringify(b.toJSON())}if(B.emulateJSON){m.contentType="application/x-www-form-urlencoded";m.data=m.data?{model:m.data}:
{}}if(B.emulateHTTP&&(g==="PUT"||g==="DELETE")){if(B.emulateJSON)m.data._method=g;m.type="POST";m.beforeSend=function(k){k.setRequestHeader("X-HTTP-Method-Override",g)}}if(m.type!=="GET"&&!B.emulateJSON)m.processData=false;return G.ajax(m)};var C=function(){},d=function(a,b,m){var g;g=b&&b.hasOwnProperty("constructor")?b.constructor:function(){return a.apply(this,arguments)};o.extend(g,a);C.prototype=a.prototype;g.prototype=new C;b&&o.extend(g.prototype,b);m&&o.extend(g,m);g.prototype.constructor=
g;g.__super__=a.prototype;return g},j=function(a){if(!a||!a.url)return null;return o.isFunction(a.url)?a.url():a.url},n=function(){throw Error('A "url" property or function must be specified');},A=function(a,b,m){return function(g){a?a(b,g,m):b.trigger("error",b,g,m)}}}).call(this);/*

 jQuery Templates Plugin 1.0.0pre
 http://github.com/jquery/jquery-tmpl
 Requires jQuery 1.4.2

 Copyright Software Freedom Conservancy, Inc.
 Dual licensed under the MIT or GPL Version 2 licenses.
 http://jquery.org/license
*/
(function(q){function F(k,h,s,t){t={data:t||t===0||t===false?t:h?h.data:{},_wrap:h?h._wrap:null,tmpl:null,parent:h||null,nodes:[],calls:f,nest:D,wrap:z,html:e,update:p};k&&q.extend(t,k,{nodes:[],parent:h});if(s){t.tmpl=s;t._ctnt=t._ctnt||t.tmpl(q,t);t.key=++b;(g.length?n:j)[b]=t}return t}function B(k,h,s){var t;s=s?q.map(s,function(x){return typeof x==="string"?k.key?x.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+C+'="'+k.key+'" $2'):x:B(x,k,x._ctnt)}):k;if(h)return s;s=s.join("");s.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(x,c,i,l){t=q(i).get();u(t);if(c)t=o(c).concat(t);if(l)t=t.concat(o(l))});return t?t:o(s)}function o(k){var h=document.createElement("div");h.innerHTML=k;return q.makeArray(h.childNodes)}function G(k){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+q.trim(k).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(h,s,t,x,c,i,l){h=q.tmpl.tag[t];if(!h)throw"Unknown template tag: "+t;t=h._default||[];if(i&&!/\w$/.test(c)){c+=i;i=""}if(c){c=v(c);l=l?","+v(l)+")":i?")":"";l=i?c.indexOf(".")>-1?c+v(i):"("+c+").call($item"+l:c;i=i?l:"(typeof("+c+")==='function'?("+c+").call($item):("+c+"))"}else i=l=t.$1||"null";x=v(x);return"');"+h[s?"close":"open"].split("$notnull_1").join(c?"typeof("+c+")!=='undefined' && ("+c+")!=null":"true").split("$1a").join(i).split("$1").join(l).split("$2").join(x||t.$2||"")+"__.push('"})+
"');}return __;")}function y(k,h){k._wrap=B(k,true,q.isArray(h)?h:[d.test(h)?h:q(h).html()]).join("")}function v(k){return k?k.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function u(k){function h(E){function H(N){N+=s;J=c[N]=c[N]||F(J,j[J.parent.key+s]||J.parent)}var I,M=E,J,O;if(O=E.getAttribute(C)){for(;M.parentNode&&(M=M.parentNode).nodeType===1&&!(I=M.getAttribute(C)););if(I!==O){M=M.parentNode?M.nodeType===11?0:M.getAttribute(C)||0:0;if(!(J=j[O])){J=n[O];J=F(J,j[M]||n[M]);J.key=++b;j[b]=J}m&&
H(O)}E.removeAttribute(C)}else if(m&&(J=q.data(E,"tmplItem"))){H(J.key);j[J.key]=J;M=(M=q.data(E.parentNode,"tmplItem"))?M.key:0}if(J){for(I=J;I&&I.key!=M;){I.nodes.push(E);I=I.parent}delete J._ctnt;delete J._wrap;q.data(E,"tmplItem",J)}}var s="_"+m,t,x,c={},i,l,w;i=0;for(l=k.length;i<l;i++)if((t=k[i]).nodeType===1){x=t.getElementsByTagName("*");for(w=x.length-1;w>=0;w--)h(x[w]);h(t)}}function f(k,h,s,t){if(!k)return g.pop();g.push({_:k,tmpl:h,item:this,data:s,options:t})}function D(k,h,s){return q.tmpl(q.template(k),
h,s,this)}function z(k,h){var s=k.options||{};s.wrapped=h;return q.tmpl(q.template(k.tmpl),k.data,s,k.item)}function e(k,h){var s=this._wrap;return q.map(q(q.isArray(s)?s.join(""):s).filter(k||"*"),function(t){if(h)t=t.innerText||t.textContent;else{var x;if(!(x=t.outerHTML)){x=document.createElement("div");x.appendChild(t.cloneNode(true));x=x.innerHTML}t=x}return t})}function p(){var k=this.nodes;q.tmpl(null,null,null,this).insertBefore(k[0]);q(k).remove()}var r=q.fn.domManip,C="_tmplitem",d=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,
j={},n={},A,a={key:0,data:{}},b=0,m=0,g=[];q.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(k,h){q.fn[k]=function(s){var t=[];s=q(s);var x,c,i;x=this.length===1&&this[0].parentNode;A=j||{};if(x&&x.nodeType===11&&x.childNodes.length===1&&s.length===1){s[h](this[0]);t=this}else{c=0;for(i=s.length;c<i;c++){m=c;x=(c>0?this.clone(true):this).get();q(s[c])[h](x);t=t.concat(x)}m=0;t=this.pushStack(t,k,s.selector)}s=A;A=null;q.tmpl.complete(s);
return t}});q.fn.extend({tmpl:function(k,h,s){return q.tmpl(this[0],k,h,s)},tmplItem:function(){return q.tmplItem(this[0])},template:function(k){return q.template(k,this[0])},domManip:function(k,h,s){if(k[0]&&q.isArray(k[0])){for(var t=q.makeArray(arguments),x=k[0],c=x.length,i=0,l;i<c&&!(l=q.data(x[i++],"tmplItem")););if(l&&m)t[2]=function(w){q.tmpl.afterManip(this,w,s)};r.apply(this,t)}else r.apply(this,arguments);m=0;A||q.tmpl.complete(j);return this}});q.extend({tmpl:function(k,h,s,t){var x=!t;
if(x){t=a;k=q.template[k]||q.template(null,k);n={}}else if(!k){k=t.tmpl;j[t.key]=t;t.nodes=[];t.wrapped&&y(t,t.wrapped);return q(B(t,null,t.tmpl(q,t)))}if(!k)return[];if(typeof h==="function")h=h.call(t||{});s&&s.wrapped&&y(s,s.wrapped);h=q.isArray(h)?q.map(h,function(c){return c?F(s,t,k,c):null}):[F(s,t,k,h)];return x?q(B(t,null,h)):h},tmplItem:function(k){var h;if(k instanceof q)k=k[0];for(;k&&k.nodeType===1&&!(h=q.data(k,"tmplItem"))&&(k=k.parentNode););return h||a},template:function(k,h){if(h){if(typeof h===
"string")h=G(h);else if(h instanceof q)h=h[0]||{};if(h.nodeType)h=q.data(h,"tmpl")||q.data(h,"tmpl",G(h.innerHTML));return typeof k==="string"?q.template[k]=h:h}return k?typeof k!=="string"?q.template(null,k):q.template[k]||q.template(null,d.test(k)?k:q(k)):null},encode:function(k){return(""+k).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});q.extend(q.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},
wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){j=
{}},afterManip:function(k,h,s){var t=h.nodeType===11?q.makeArray(h.childNodes):h.nodeType===1?[h]:[];s.call(k,h);u(t);m++}})})(jQuery);/*
 
 JavaScript Debug - v0.4 - 6/22/2010
 http://benalman.com/projects/javascript-debug-console-log/

 Copyright (c) 2010 "Cowboy" Ben Alman
 Dual licensed under the MIT and GPL licenses.
 http://benalman.com/about/license/

 With lots of help from Paul Irish!
 http://paulirish.com/
*/
window.debug=function(){function q(p){if(y&&(v||!o||!o.log))y.apply(F,p)}for(var F=this,B=Array.prototype.slice,o=F.console,G={},y,v,u=9,f=["error","warn","info","debug","log"],D="assert clear count dir dirxml exception group groupCollapsed groupEnd profile profileEnd table time timeEnd trace".split(" "),z=D.length,e=[];--z>=0;)(function(p){G[p]=function(){u!==0&&o&&o[p]&&o[p].apply(o,arguments)}})(D[z]);for(z=f.length;--z>=0;)(function(p,r){G[r]=function(){var C=B.call(arguments),d=[r].concat(C);
e.push(d);q(d);if(o&&(u>0?u>p:f.length+u<=p))o.firebug?o[r].apply(F,C):o[r]?o[r](C):o.log(C)}})(z,f[z]);G.setLevel=function(p){u=typeof p==="number"?p:9};G.setCallback=function(){var p=B.call(arguments),r=e.length,C=r;y=p.shift()||null;v=typeof p[0]==="boolean"?p.shift():false;for(C-=typeof p[0]==="number"?p.shift():r;C<r;)q(e[C++])};return G}();(function(q){var F=q("<b/>");q.subscribe=function(B,o){function G(){return o.apply(this,Array.prototype.slice.call(arguments,1))}G.guid=o.guid=o.guid||(q.guid?q.guid++:q.event.guid++);F.bind(B,G)};q.unsubscribe=function(){F.unbind.apply(F,arguments)};q.publish=function(){F.trigger.apply(F,arguments)}})(jQuery);/*

 Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 Licensed under the MIT License (LICENSE.txt).

 Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 Thanks to: Seamus Leahy for adding deltaX and deltaY

 Version: 3.0.6

 Requires: 1.2.2+
*/
(function(a){function d(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=!0,g=0,h=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),h=e,c.axis!==undefined&&c.axis===c.HORIZONTAL_AXIS&&(h=0,g=-1*e),c.wheelDeltaY!==undefined&&(h=c.wheelDeltaY/120),c.wheelDeltaX!==undefined&&(g=-1*c.wheelDeltaX/120),d.unshift(b,e,g,h),(a.event.dispatch||a.event.handle).apply(this,d)}var b=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var c=b.length;c;)a.event.fixHooks[b[--c]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=b.length;a;)this.addEventListener(b[--a],d,!1);else this.onmousewheel=d},teardown:function(){if(this.removeEventListener)for(var a=b.length;a;)this.removeEventListener(b[--a],d,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery)
/*

 jQuery.UI.iPad plugin
 Copyright (c) 2010 Stephen von Takach
 licensed under MIT.
 Date: 27/8/2010

 Project Home: 
 http://code.google.com/p/jquery-ui-for-ipad-and-iphone/
*/
$(function(){$.extend($.support,{touch:"ontouchend"in document});$.fn.addTouch=function(){$.support.touch&&this.each(function(q,F){F.addEventListener("touchstart",iPadTouchHandler,false);F.addEventListener("touchmove",iPadTouchHandler,false);F.addEventListener("touchend",iPadTouchHandler,false);F.addEventListener("touchcancel",iPadTouchHandler,false)})}});var lastTap=null,tapValid=false,tapTimeout=null;function cancelTap(){tapValid=false}
var rightClickPending=false,rightClickEvent=null,holdTimeout=null,cancelMouseUp=false;function cancelHold(){if(rightClickPending){window.clearTimeout(holdTimeout);rightClickPending=false;rightClickEvent=null}}function startHold(q){if(!rightClickPending){rightClickPending=true;rightClickEvent=q.changedTouches[0];holdTimeout=window.setTimeout("doRightClick();",800)}}
function doRightClick(){rightClickPending=false;var q=rightClickEvent,F=document.createEvent("MouseEvent");F.initMouseEvent("mouseup",true,true,window,1,q.screenX,q.screenY,q.clientX,q.clientY,false,false,false,false,0,null);q.target.dispatchEvent(F);F=document.createEvent("MouseEvent");F.initMouseEvent("mousedown",true,true,window,1,q.screenX,q.screenY,q.clientX,q.clientY,false,false,false,false,2,null);q.target.dispatchEvent(F);F=document.createEvent("MouseEvent");F.initMouseEvent("contextmenu",
true,true,window,1,q.screenX+50,q.screenY+5,q.clientX+50,q.clientY+5,false,false,false,false,2,null);q.target.dispatchEvent(F);cancelMouseUp=true;rightClickEvent=null}
function iPadTouchStart(q){var F=q.changedTouches[0],B="mouseover",o=document.createEvent("MouseEvent");o.initMouseEvent(B,true,true,window,1,F.screenX,F.screenY,F.clientX,F.clientY,false,false,false,false,0,null);F.target.dispatchEvent(o);B="mousedown";o=document.createEvent("MouseEvent");o.initMouseEvent(B,true,true,window,1,F.screenX,F.screenY,F.clientX,F.clientY,false,false,false,false,0,null);F.target.dispatchEvent(o);if(tapValid){window.clearTimeout(tapTimeout);if(F.target==lastTap){lastTap=
null;tapValid=false;B="click";o=document.createEvent("MouseEvent");o.initMouseEvent(B,true,true,window,1,F.screenX,F.screenY,F.clientX,F.clientY,false,false,false,false,0,null);F.target.dispatchEvent(o);B="dblclick";o=document.createEvent("MouseEvent");o.initMouseEvent(B,true,true,window,1,F.screenX,F.screenY,F.clientX,F.clientY,false,false,false,false,0,null);F.target.dispatchEvent(o)}else{lastTap=F.target;tapValid=true;tapTimeout=window.setTimeout("cancelTap();",600);startHold(q)}}else{lastTap=
F.target;tapValid=true;tapTimeout=window.setTimeout("cancelTap();",600);startHold(q)}}
function iPadTouchHandler(q){var F="";if(!(q.touches.length>1)){switch(q.type){case "touchstart":if($(q.changedTouches[0].target).is("select"))return;iPadTouchStart(q);q.preventDefault();return false;case "touchmove":cancelHold();F="mousemove";q.preventDefault();break;case "touchend":if(cancelMouseUp){cancelMouseUp=false;q.preventDefault();return false}cancelHold();F="mouseup";break;default:return}q=q.changedTouches[0];var B=document.createEvent("MouseEvent");B.initMouseEvent(F,true,true,window,1,
q.screenX,q.screenY,q.clientX,q.clientY,false,false,false,false,0,null);q.target.dispatchEvent(B);if(F=="mouseup"&&tapValid&&q.target==lastTap){B=document.createEvent("MouseEvent");B.initMouseEvent("click",true,true,window,1,q.screenX,q.screenY,q.clientX,q.clientY,false,false,false,false,0,null);q.target.dispatchEvent(B)}}};(function(){function q(g){return(g+"").replace(n,"")}function F(g,k,h){for(var s=g.length;s<k;s++)g=h?"0"+g:g+"0";return g}function B(g){return m.call(g)==="[object Array]"}function o(g,k){if(g.indexOf)return g.indexOf(k);for(var h=0,s=g.length;h<s;h++)if(g[h]===k)return h;return-1}function G(g,k,h){var s=k["-"];k=k["+"];var t;switch(h){case "n -":s=" "+s;k=" "+k;case "n-":if(g.substr(g.length-s.length)===s)t=["-",g.substr(0,g.length-s.length)];else if(g.substr(g.length-k.length)===k)t=["+",g.substr(0,
g.length-k.length)];break;case "- n":s+=" ";k+=" ";case "-n":if(g.indexOf(s)===0)t=["-",g.substr(s.length)];else if(g.indexOf(k)===0)t=["+",g.substr(k.length)];break;case "(n)":if(g.indexOf("(")===0&&g.substr(g.length-1)===")")t=["-",g.substr(1,g.length-2)]}return t||["",g]}function y(g,k){if(!k)return 0;for(var h,s=g.getTime(),t=0,x=k.length;t<x;t++){h=k[t].start;if(h===null||s>=h)return t}return 0}function v(g){return g.split("\u00a0").join(" ").toUpperCase()}function u(g){for(var k=[],h=0,s=g.length;h<
s;h++)k[h]=v(g[h]);return k}function f(g,k,h,s){g=g.getFullYear();if(!s&&k.eras)g-=k.eras[h].offset;return g}function D(g,k){for(var h=0,s=false,t=0,x=g.length;t<x;t++){var c=g.charAt(t);switch(c){case "'":if(s)k.push("'");else h++;s=false;break;case "\\":s&&k.push("\\");s=!s;break;default:k.push(c);s=false}}return h}function z(g,k){k=k||"F";var h;h=g.patterns;var s=k.length;if(s===1){h=h[k];if(!h)throw"Invalid date format string '"+k+"'.";k=h}else if(s===2&&k.charAt(0)==="%")k=k.charAt(1);return k}
function e(){return/\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|gg|g/g}function p(g,k,h){g=q(g);h=h.calendar;a:{var s=h._parseRegExp;if(s){var t=s[k];if(t){k=t;break a}}else h._parseRegExp=s={};t=z(h,k).replace(/([\^\$\.\*\+\?\|\[\]\(\)\{\}])/g,"\\\\$1");for(var x=["^"],c=[],i=0,l=0,w=e(),E;(E=w.exec(t))!==null;){var H=t.slice(i,E.index);i=w.lastIndex;l+=D(H,x);if(l%2)x.push(E[0]);else{H=E[0];var I=H.length;switch(H){case "dddd":case "ddd":case "MMMM":case "MMM":case "gg":case "g":H=
"(\\D+)";break;case "tt":case "t":H="(\\D*)";break;case "yyyy":case "fff":case "ff":case "f":H="(\\d{"+I+"})";break;case "dd":case "d":case "MM":case "M":case "yy":case "y":case "HH":case "H":case "hh":case "h":case "mm":case "m":case "ss":case "s":H="(\\d\\d?)";break;case "zzz":H="([+-]?\\d\\d?:\\d{2})";break;case "zz":case "z":H="([+-]?\\d\\d?)";break;case "/":H="(\\"+h["/"]+")";break;default:throw"Invalid date format pattern '"+H+"'.";}H&&x.push(H);c.push(E[0])}}D(t.slice(i),x);x.push("$");t={regExp:x.join("").replace(/\s+/g,
"\\s+"),groups:c};k=s[k]=t}l=RegExp(k.regExp).exec(g);if(l===null)return null;w=k.groups;var M=g=null,J=null,O=k=null;c=x=t=s=0;E=null;i=false;H=0;for(I=w.length;H<I;H++){var N=l[H+1];if(N){var P=w[H],K=P.length,L=parseInt(N,10);switch(P){case "dd":case "d":k=L;if(k<1||k>31)return null;break;case "MMM":case "MMMM":J=h;K=K===3;P=J.months;var Q=J.monthsGenitive||J.months,R=J._upperMonths;L=J._upperMonthsGen;if(!R){J._upperMonths=R=[u(P.names),u(P.namesAbbr)];J._upperMonthsGen=L=[u(Q.names),u(Q.namesAbbr)]}N=
v(N);J=o(K?R[1]:R[0],N);if(J<0)J=o(K?L[1]:L[0],N);if(J<0||J>11)return null;break;case "M":case "MM":J=L-1;if(J<0||J>11)return null;break;case "y":case "yy":case "yyyy":if(K<4){M=h;N=L;L=new Date;P=y(L);if(N<100){K=M.twoDigitYearMax;K=typeof K==="string"?(new Date).getFullYear()%100+parseInt(K,10):K;M=f(L,M,P);N+=M-M%100;if(N>K)N-=100}M=N}else M=L;if(M<0||M>9999)return null;break;case "h":case "hh":s=L;if(s===12)s=0;if(s<0||s>11)return null;break;case "H":case "HH":s=L;if(s<0||s>23)return null;break;
case "m":case "mm":t=L;if(t<0||t>59)return null;break;case "s":case "ss":x=L;if(x<0||x>59)return null;break;case "tt":case "t":i=h.PM&&(N===h.PM[0]||N===h.PM[1]||N===h.PM[2]);if(!i&&(!h.AM||N!==h.AM[0]&&N!==h.AM[1]&&N!==h.AM[2]))return null;break;case "f":case "ff":case "fff":c=L*Math.pow(10,3-K);if(c<0||c>999)return null;break;case "ddd":case "dddd":O=N;N=K===3;L=void 0;L=h.days;K=h._upperDays;if(!K)h._upperDays=K=[u(L.names),u(L.namesAbbr),u(L.namesShort)];O=v(O);if(N){L=o(K[1],O);if(L===-1)L=o(K[2],
O)}else L=o(K[0],O);O=L;if(O<0||O>6)return null;break;case "zzz":K=N.split(/:/);if(K.length!==2)return null;E=parseInt(K[0],10);if(E<-12||E>13)return null;K=parseInt(K[1],10);if(K<0||K>59)return null;E=E*60+(N.indexOf("-")===0?-K:K);break;case "z":case "zz":E=L;if(E<-12||E>13)return null;E*=60;break;case "g":case "gg":if(!N||!h.eras)return null;N=q(N.toLowerCase());K=0;for(L=h.eras.length;K<L;K++)if(N===h.eras[K].name.toLowerCase()){g=K;break}if(g===null)return null}}}l=new Date;w=(H=h.convert)?H.fromGregorian(l)[0]:
l.getFullYear();if(M===null)M=w;else if(h.eras)M+=h.eras[g||0].offset;if(J===null)J=0;if(k===null)k=1;if(H){l=H.toGregorian(M,J,k);if(l===null)return null}else{l.setFullYear(M,J,k);if(l.getDate()!==k)return null;if(O!==null&&l.getDay()!==O)return null}if(i&&s<12)s+=12;l.setHours(s,t,x,c);if(E!==null){h=l.getMinutes()-(E+l.getTimezoneOffset());l.setHours(l.getHours()+parseInt(h/60,10),h%60)}return l}function r(g,k,h){function s(K,L){var Q;Q=K+"";if(L>1&&Q.length<L){Q=H[L-2]+Q;return Q.substr(Q.length-
L,L)}return Q}function t(){if(I||M)return I;I=J.test(k);M=true;return I}function x(K,L){if(P)return P[L];switch(L){case 0:return K.getFullYear();case 1:return K.getMonth();case 2:return K.getDate()}}var c=h.calendar,i=c.convert;if(!k||!k.length||k==="i"){if(h&&h.name.length)if(i)h=r(g,c.patterns.F,h);else{h=new Date(g.getTime());var l=y(g,c.eras);h.setFullYear(f(g,c,l));h=h.toLocaleString()}else h=g.toString();return h}l=c.eras;var w=k==="s";k=z(c,k);h=[];var E,H=["0","00","000"],I,M,J=/([^d]|^)(d|dd)([^d]|$)/g,
O=0,N=e(),P;if(!w&&i)P=i.fromGregorian(g);for(;;){E=N.lastIndex;i=N.exec(k);E=k.slice(E,i?i.index:k.length);O+=D(E,h);if(!i)break;if(O%2)h.push(i[0]);else{E=i[0];i=E.length;switch(E){case "ddd":case "dddd":h.push((i===3?c.days.namesAbbr:c.days.names)[g.getDay()]);break;case "d":case "dd":I=true;h.push(s(x(g,2),i));break;case "MMM":case "MMMM":E=x(g,1);h.push(c.monthsGenitive&&t()?c.monthsGenitive[i===3?"namesAbbr":"names"][E]:c.months[i===3?"namesAbbr":"names"][E]);break;case "M":case "MM":h.push(s(x(g,
1)+1,i));break;case "y":case "yy":case "yyyy":E=P?P[0]:f(g,c,y(g,l),w);if(i<4)E%=100;h.push(s(E,i));break;case "h":case "hh":E=g.getHours()%12;if(E===0)E=12;h.push(s(E,i));break;case "H":case "HH":h.push(s(g.getHours(),i));break;case "m":case "mm":h.push(s(g.getMinutes(),i));break;case "s":case "ss":h.push(s(g.getSeconds(),i));break;case "t":case "tt":E=g.getHours()<12?c.AM?c.AM[0]:" ":c.PM?c.PM[0]:" ";h.push(i===1?E.charAt(0):E);break;case "f":case "ff":case "fff":h.push(s(g.getMilliseconds(),3).substr(0,
i));break;case "z":case "zz":E=g.getTimezoneOffset()/60;h.push((E<=0?"+":"-")+s(Math.floor(Math.abs(E)),i));break;case "zzz":E=g.getTimezoneOffset()/60;h.push((E<=0?"+":"-")+s(Math.floor(Math.abs(E)),2)+":"+s(Math.abs(g.getTimezoneOffset()%60),2));break;case "g":case "gg":c.eras&&h.push(c.eras[y(g,l)].name);break;case "/":h.push(c["/"]);break;default:throw"Invalid date format pattern '"+E+"'.";}}}return h.join("")}var C={},d={en:{}};d["default"]=d.en;C.extend=function(g){for(var k=arguments[1]||{},
h=2,s=arguments.length;h<s;h++){var t=arguments[h];if(t)for(var x in t){var c=t[x];if(typeof c!=="undefined")if(g&&(m.call(c)==="[object Object]"||B(c))){var i=k[x];i=i&&(m.call(i)==="[object Object]"||B(i))?i:B(c)?[]:{};k[x]=this.extend(true,i,c)}else k[x]=c}}return k};C.findClosestCulture=function(g){var k;if(!g)return this.culture||this.cultures["default"];if(m.call(g)==="[object String]")g=g.split(",");if(B(g)){var h,s=this.cultures,t=g,x,c=t.length,i=[];for(x=0;x<c;x++){g=q(t[x]);g=g.split(";");
h=q(g[0]);if(g.length===1)g=1;else{g=q(g[1]);if(g.indexOf("q=")===0){g=g.substr(2);g=parseFloat(g,10);g=isNaN(g)?0:g}else g=1}i.push({lang:h,pri:g})}i.sort(function(w,E){return w.pri<E.pri?1:-1});for(x=0;x<c;x++){h=i[x].lang;if(k=s[h])return k}for(x=0;x<c;x++){h=i[x].lang;do{t=h.lastIndexOf("-");if(t===-1)break;h=h.substr(0,t);if(k=s[h])return k}while(1)}for(x=0;x<c;x++){h=i[x].lang;for(var l in s){t=s[l];if(t.language==h)return t}}}else if(typeof g==="object")return g;return k||null};C.preferCulture=
function(g){this.culture=this.findClosestCulture(g)||this.cultures["default"]};C.localize=function(g,k,h){if(typeof k!=="string")k=this.culture.name||this.culture||"default";k=this.cultures[k]||{name:k};var s=d[k.name];if(arguments.length===3){s||(s=d[k.name]={});s[g]=h}else{if(s)h=s[g];if(typeof h==="undefined"){if(s=d[k.language])h=s[g];if(typeof h==="undefined")h=d["default"][g]}}return typeof h==="undefined"?null:h};C.format=function(g,k,h){h=this.findClosestCulture(h);if(typeof g==="number"){var s=
g;if(!k||k==="i")g=h.name.length?s.toLocaleString():s.toString();else{k=k||"D";h=h.numberFormat;g=Math.abs(s);var t=-1;if(k.length>1)t=parseInt(k.slice(1),10);var x=k.charAt(0).toUpperCase(),c;switch(x){case "D":k="n";if(t!==-1)g=F(""+g,t,true);if(s<0)g=-g;break;case "N":c=h;case "C":c=c||h.currency;case "P":c=c||h.percent;k=s<0?c.pattern[0]:c.pattern[1]||"n";if(t===-1)t=c.decimals;b:{var i=g*(x==="P"?100:1);x=c;c=x.groupSizes;g=c[0];s=1;var l=Math.pow(10,t),w=Math.round(i*l)/l;isFinite(w)||(w=i);
l="";l=(w+"").split(/e/i);w=l.length>1?parseInt(l[1],10):0;i=l[0];l=i.split(".");i=l[0];l=l.length>1?l[1]:"";if(w>0){l=F(l,w,false);i+=l.slice(0,w);l=l.substr(w)}else if(w<0){w=-w;i=F(i,w+1);l=i.slice(-w,i.length)+l;i=i.slice(0,-w)}l=t>0?x["."]+(l.length>t?l.slice(0,t):F(l,t)):"";t=i.length-1;x=x[","];for(w="";t>=0;){if(g===0||g>t){g=i.slice(0,t+1)+(w.length?x+w+l:l);break b}w=i.slice(t-g+1,t+1)+(w.length?x+w:"");t-=g;if(s<c.length){g=c[s];s++}}g=i.slice(0,t+1)+x+w+l}break;default:throw"Bad number format specifier: "+
x;}c=/n|\$|-|%/g;for(s="";;){t=c.lastIndex;x=c.exec(k);s+=k.slice(t,x?x.index:k.length);if(!x)break;switch(x[0]){case "n":s+=g;break;case "$":s+=h.currency.symbol;break;case "-":if(/[1-9]/.test(g))s+=h["-"];break;case "%":s+=h.percent.symbol}}g=s}}else if(g instanceof Date)g=r(g,k,h);return g};C.parseInt=function(g,k,h){return Math.floor(this.parseFloat(g,k,h))};C.parseFloat=function(g,k,h){if(typeof k==="string"){h=k;k=10}h=this.findClosestCulture(h);var s=NaN,t=h.numberFormat;if(g.indexOf(h.numberFormat.currency.symbol)>
-1){g=g.replace(h.numberFormat.currency.symbol,"");g=g.replace(h.numberFormat.currency["."],h.numberFormat["."])}g=q(g);if(A.test(g))s=parseFloat(g,k);else if(!k&&a.test(g))s=parseInt(g,16);else{h=G(g,t,t.pattern[0]);k=h[0];h=h[1];if(k===""&&t.pattern[0]!=="-n"){h=G(g,t,"-n");k=h[0];h=h[1]}k=k||"+";var x;g=h.indexOf("e");if(g<0)g=h.indexOf("E");if(g<0){x=h;g=null}else{x=h.substr(0,g);g=h.substr(g+1)}var c=t["."],i=x.indexOf(c);if(i<0){h=x;x=null}else{h=x.substr(0,i);x=x.substr(i+c.length)}c=t[","];
h=h.split(c).join("");i=c.replace(/\u00A0/g," ");if(c!==i)h=h.split(i).join("");k+=h;if(x!==null)k+="."+x;if(g!==null){t=G(g,t,"-n");k+="e"+(t[0]||"+")+t[1]}if(b.test(k))s=parseFloat(k)}return s};C.parseDate=function(g,k,h){h=this.findClosestCulture(h);var s,t;if(k){if(typeof k==="string")k=[k];if(k.length){t=0;for(var x=k.length;t<x;t++){var c=k[t];if(c)if(s=p(g,c,h))break}}}else{k=h.calendar.patterns;for(t in k)if(s=p(g,k[t],h))break}return s||null};var j=C.cultures=C.cultures||{};j=j["default"]=
j.en=C.extend(true,{name:"en",englishName:"English",nativeName:"English",isRTL:false,language:"en",numberFormat:{pattern:["-n"],decimals:2,",":",",".":".",groupSizes:[3],"+":"+","-":"-",percent:{pattern:["-n %","n %"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"%"},currency:{pattern:["($n)","$n"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"$"}},calendars:{standard:{name:"Gregorian_USEnglish","/":"/",":":":",firstDay:0,days:{names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday",
"Saturday"],namesAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],namesShort:["Su","Mo","Tu","We","Th","Fr","Sa"]},months:{names:["January","February","March","April","May","June","July","August","September","October","November","December",""],namesAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""]},AM:["AM","am","AM"],PM:["PM","pm","PM"],eras:[{name:"A.D.",start:null,offset:0}],twoDigitYearMax:2029,patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",t:"h:mm tt",T:"h:mm:ss tt",
f:"dddd, MMMM dd, yyyy h:mm tt",F:"dddd, MMMM dd, yyyy h:mm:ss tt",M:"MMMM dd",Y:"yyyy MMMM",S:"yyyy'-'MM'-'dd'T'HH':'mm':'ss"}}}},j.en);j.calendar=j.calendar||j.calendars.standard;var n=/^\s+|\s+$/g,A=/^[+-]?infinity$/i,a=/^0x[a-f0-9]+$/i,b=/^[+-]?\d*\.?\d*(e[+-]?\d+)?$/,m=Object.prototype.toString;jQuery.global=C})();timeglider=window.timeglider||{version:"0.1.0"};timeglider.TG_Date={};
(function(q){function F(e){return parseInt(e,10)}function B(e){var p=parseInt(e,10);return p>9||p<0?String(e):"0"+p}q=timeglider;var o=jQuery,G={},y={},v={},u={},f={},D=/^(\-?\d+)?(\-\d{1,2})?(\-\d{1,2})?(?:T| )?(\d{1,2})?(?::)?(\d{1,2})?(?::)?(\d{1,2})?(\+|\-)?(\d{1,2})?(?::)?(\d{1,2})?/;q.TG_Date=function(e,p,r){var C,d,j;r=r||0;if(typeof e=="number"){C=d=z.getDateFromSec(e);j=e+r}else if(typeof e!=="object"){if(e=="today")e=z.getToday();C=d=e}if(D.test(C)){e=z.parse8601(C);if(e.tz_ho)e=z.toFromUTC(e,
{hours:e.tz_ho,minutes:e.tz_mi},"to");o.extend(this,e);this.rd=z.getRataDie(this);this.mo_num=this.ye>0?(this.ye-1)*12+this.mo:-1*((Math.abs(this.ye)-1)*12+(12-(this.mo-1)));if(!j){j=Math.abs(this.rd)*86400;e=this.ho*3600;C=(this.mi-1)*60;r=1;if(this.rd<0)r=-1;j=r*(j+e+C)}this.sec=j;this.date_display=p?p.toLowerCase().substr(0,2):"da";this.dateStr=d}else return{error:"invalid date"};return this};var z=q.TG_Date;z.getTimeUnitSerial=function(e,p){var r=0;switch(p){case "da":r=e.rd;break;case "mo":r=
e.mo_num;break;case "ye":r=e.ye;break;case "de":r=Math.floor(e.ye/10);break;case "ce":r=Math.floor(e.ye/100);break;case "thou":r=Math.floor(e.ye/1E3);break;case "tenthou":r=Math.floor(e.ye/1E4);break;case "hundredthou":r=Math.floor(e.ye/1E5);break;case "mill":r=Math.floor(e.ye/1E6);break;case "tenmill":r=Math.floor(e.ye/1E7);break;case "hundredmill":r=Math.floor(e.ye/1E8);break;case "bill":r=Math.floor(e.ye/1E9)}return r};z.getMonthDays=function(e,p){return z.isLeapYear(p)==true&&e==2?29:z.monthsDayNums[e]};
z.twentyFourToTwelve=function(e){var p={};p.ye=e.ye;p.mo=e.mo;p.da=e.da;p.ho=e.ho;p.mi=e.mi;p.ampm="am";if(e.ho)if(e.ho>=12){p.ampm="pm";p.ho=e.ho>12?e.ho-12:12}else if(e.ho==0){p.ho=12;p.ampm="am"}else p.ho=e.ho;else{p.ho=12;p.mi=0;p.ampm="am"}return p};z.getMonthAdj=function(e,p){var r=z.getDateFromMonthNum(e);switch(r.mo){case 1:case 3:case 5:case 7:case 8:case 10:case 12:r=Math.floor(p+p/28*3);return{width:r,days:31};case 2:if(z.isLeapYear(r.ye)==true){r=Math.floor(p+p/28);return{width:r,days:29}}else return{width:p,
days:28};default:r=Math.floor(p+p/28*2);return{width:r,days:30}}};z.getDateFromMonthNum=function(e){var p=0;if(e>0){p=e%12;if(p==0)p=12;e=Math.ceil(e/12)}else{p=Math.abs(e)%12;p=12-p+1;if(p==13)p=1;e=-1*Math.ceil(Math.abs(e)/12)}return{ye:e,mo:p}};z.getMonthWidth=function(e,p,r){var C=r/28,d;switch(e){case 1:case 3:case 5:case 7:case 8:case 10:case 12:d=3;break;case 4:case 6:case 9:case 11:d=2;break;case 2:d=z.isLeapYear(p)==true?1:0}return{width:Math.floor(r+C*d),numDays:28+d}};z.getToday=function(){var e=
new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":00"};z.getMonthFromRemDays=function(e,p){var r=0;var C=r=0;r=z.isLeapYear(p)?1:0;if(e<=31){C=1;r=e}else if(e>31&&e<=59+r){C=2;r=e-(31+r)}else if(e>59+r&&e<=90+r){C=3;r=e-(59+r)}else if(e>90+r&&e<=120+r){C=4;r=e-(90+r)}else if(e>120+r&&e<=151+r){C=5;r=e-(120+r)}else if(e>151+r&&e<=181+r){C=6;r=e-(151+r)}else if(e>181+r&&e<=212+r){C=7;r=e-(181+r)}else if(e>212+r&&e<=243+r){C=8;r=e-(212+r)}else if(e>
243+r&&e<=273+r){C=9;r=e-(243+r)}else if(e>273+r&&e<=304+r){C=10;r=e-(273+r)}else if(e>304+r&&e<=334+r){C=11;r=e-(304+r)}else{C=12;r=e-(334+r)}return{mo:C,da:r}};z.getDateFromRD=function(e){if(u[e])return u[e];for(var p=Math.floor(e),r=Math.floor(p/146097)*400,C=p-Math.floor(p/146097)*146097,d=1,j=r+1,n=j+400;j<=n;j++)if(C>365){C-=365;if(z.isLeapYear(j))C-=1;d++}else j=n;r+=d;if(C==0)C=1;C=z.getMonthFromRemDays(C,r);d=(e-p)*1440;p=Math.floor(d%60);d=Math.floor(d/60);if(z.isLeapYear(r)&&C.mo==2)C.da+=
1;p=r+"-"+C.mo+"-"+C.da+" "+d+":"+p+":00";return u[e]=p};z.getDateFromSec=function(e){if(f[e])return f[e];var p=z.getDateFromRD(e/86400);return f[e]=p};z.isLeapYear=function(e){return e%400==0?true:e%100==0?false:e%4==0?true:false};z.getRataDie=function(e){function p(a,b){if(y[a+"-"+b])return y[a+"-"+b];for(var m=0,g=a;g<b;g++)m+=z.isLeapYear(g)?366:365;return y[a+"-"+b]=m}function r(a,b){var m;switch(a){case 1:m=0;break;case 2:m=31;break;case 3:m=59;break;case 4:m=90;break;case 5:m=120;break;case 6:m=
151;break;case 7:m=181;break;case 8:m=212;break;case 9:m=243;break;case 10:m=273;break;case 11:m=304;break;case 12:m=334}if(a>2)if(z.isLeapYear(b))m+=1;return m}var C=e.ye,d=e.mo;e=e.da;var j=0;if(G[C+"-"+d+"-"+e])return G[C+"-"+d+"-"+e];if(C>=0){if(C==0)C=1;j=Math.floor(C/400)*146097;var n=parseInt(p(C-C%400,C)),A=parseInt(r(d,C));j=j+n+A+e-366}else if(C<0)j=z.getBCRataDie({ye:C,mo:d,da:e});return G[C+"-"+d+"-"+e]=j};z.monthNamesLet=["","J","F","M","A","M","J","J","A","S","O","N","D"];z.monthsDayNums=
[0,31,28,31,30,31,30,31,31,30,31,30,31,29];z.units=["da","mo","ye","de","ce","thou","tenthou","hundredthou","mill","tenmill","hundredmill","bill"];z.getBCRataDie=function(e){var p=e.ye,r=e.mo;e=e.da;if(v[p+"-"+r+"-"+e])return v[p+"-"+r+"-"+e];if(r==0)r=1;if(e==0)e=1;var C=-1*((Math.abs(p)-1)*366+[0,335,306,275,245,214,184,153,122,92,61,31,0][r]+(z.monthsDayNums[r]-e+1));return v[p+"-"+r+"-"+e]=C};z.setCulture=function(e){jQuery.global.culture=jQuery.global.cultures[e];z.monthNames=o.merge([""],jQuery.global.culture.calendar.months.names);
z.monthNamesAbbr=o.merge([""],jQuery.global.culture.calendar.months.namesAbbr);z.dayNames=jQuery.global.culture.calendar.days.names;z.dayNamesAbbr=jQuery.global.culture.calendar.days.namesAbbr;z.dayNamesShort=jQuery.global.culture.calendar.days.namesShort;z.patterns=jQuery.global.culture.calendar.patterns};z.prototype={format:function(e,p,r){r=r||{hours:0,minutes:0};if(p==true)switch(this.date_display.substr(0,2)){case "no":return"";case "ye":e="yyyy";break;case "mo":e="MMM yyyy";break;case "da":e=
"MMM d, yyyy";break;case "ho":e="MMM d, yyyy h:mm tt";break;default:e="f"}if(this.ye>-27E4){p=z.toFromUTC(_.clone(this),r,"from");p=new Date(p.ye,p.mo-1,p.da,p.ho,p.mi,p.se,0);return o.global.format(p,e)}else return this.ye}};z.getTimeOffset=function(e){e=e.replace(/[^-\d:]/gi,"");var p=e.split(":"),r=parseInt(p[0],10);p=parseInt(p[1],10);var C=r+(r<0?-1:1)*(p/60);return{decimal:C,hours:r,minutes:p,seconds:C*3600,string:e}};z.tzOffsetStr=function(e,p){if(e){if(e.length==19)e+=p;else if(e.length==
16)e+=":00"+p;return e}};z.parse8601=function(e){var p,r,C,d,j,n,A,a;j=function(b){return b?parseInt(b.replace("-",""),10):0};a=e.match(D);e=parseInt(a[1]);if(!e)return{error:"invalid date; no year provided"};p=j(a[2])||1;r=j(a[3])||1;C=j(a[4])||1;d=j(a[5])||0;j=j(a[6])||0;n=a[7]||"+";A=parseInt(a[8],10)||0;if(n=="-")A*=-1;a=parseInt(a[9],10)||0;if(n=="-")a*=-1;return{ye:e,mo:p,da:r,ho:C,mi:d,se:j,tz_ho:A,tz_mi:a}};z.getLastDayOfMonth=function(e,p){var r=[0,31,28,31,30,31,30,31,31,30,31,30,31],C=
0;return C=p==2&&z.isLeapYear(e)==true?29:r[p]};z.getDateTimeStrings=function(e){var p=z.parse8601(e);e=p.ye+"-"+B(p.mo)+"-"+B(p.da);var r="pm";if(p.ho>12){p.ho-=12;r="pm"}else{if(p.ho==0)p.ho="12";r="am"}p=F(p.ho)+":"+B(p.mi)+" "+r;return{date:e,time:p}};z.transValidateDateString=function(e){if(!e)return false;var p=e.match(/^(\-?\d+|today|now) ?(bce?)?-?(\d{1,2})?-?(\d{1,2})?/);e=z.zeroButt;if(p){var r=p[1],C=p[2]||"",d=p[3]||"07";p=p[4]||"1";if(parseInt(r,10)<0||C.substr(0,1)=="b")r=-1*Math.abs(r);
return z.validateDate(r,d,p)?r+"-"+e(d)+"-"+e(p):false}else return false};z.transValidateTimeString=function(e){if(!e)return"12:00:00";e=e.toLowerCase().match(/^(\d{1,2}|noon):?(\d{1,2})?:?(\d{1,2})? ?(am|pm)?/i);var p="";p=z.zeroButt;if(e[1])if(e[0]=="noon")p="12:00:00";else{var r=parseInt(e[1],10)||12,C=parseInt(e[2],10)||0,d=parseInt(e[3],10)||0;e=e[4]||"am";if(z.validateTime(r,C,d)==false)return false;if(e=="pm"&&r<12)r+=12;p=p(r)+":"+p(C)+":"+p(d)}else p=false;return p};z.validateTime=function(e,
p,r){if(e<0||e>23||p<0||p>59||r<0||r>59)return false;return true};z.validateDate=function(e,p,r){var C=z.getMonthDays(p,e);if(r>C||r<=0)return false;if(p>12||p<0)return false;if(e==0)return false;return true};z.zeroButt=function(e){e=parseInt(e,10);return e>9?String(e):"0"+e};z.toFromUTC=function(e,p,r){var C=0,d=[0,31,28,31,30,31,30,31,31,30,31,30,31,29];C={};if(r=="from"){C.ho=-1*p.hours;C.mi=-1*p.minutes}else if(r=="to"){C.ho=p.hours;C.mi=p.minutes}else{C.ho=-1*e.tz_ho;C.mi=-1*e.tz_mi}if(C.ho==
0&&C.mi==0)return e;r=e.ho+e.mi/60+(-1*C.ho+C.mi*-1/60);if(r<0){C=24+r;if(e.da>1)e.da-=1;else if(e.mo==1){e.ye-=1;e.mo=12;e.da=31}else{e.mo-=1;e.da=z.getLastDayOfMonth(e.ye,e.mo)}}else if(r>=24){C=r-24;if(z.isLeapYear(e.ye)&&e.mo==2&&e.da==28)e.da=29;else if(e.da==d[e.mo]){if(e.mo==12){e.ye+=1;e.mo=1}else e.mo+=1;e.da=1}else e.da+=1}else C=r;d=function(j){j=Math.abs(j);var n=Math.floor(j);return{ho:n,mi:Math.round((j-n)*60),se:0}}(C);e.ho=d.ho;e.mi=d.mi;if(p){e.tz_ho=p.tz_ho;e.tz_mi=p.tz_mi}else{e.tz_ho=
0;e.tz_mi=0}return{ye:e.ye,mo:e.mo,da:e.da,ho:e.ho,mi:e.mi,se:e.se}};z.timezones=[{offset:"-12:00",name:"Int'l Date Line West"},{offset:"-11:00",name:"Bering & Nome"},{offset:"-10:00",name:"Alaska-Hawaii Standard Time"},{offset:"-10:00",name:"U.S. Hawaiian Standard Time"},{offset:"-10:00",name:"U.S. Central Alaska Time"},{offset:"-09:00",name:"U.S. Yukon Standard Time"},{offset:"-08:00",name:"U.S. Pacific Standard Time"},{offset:"-07:00",name:"U.S. Mountain Standard Time"},{offset:"-07:00",name:"U.S. Pacific Daylight Time"},
{offset:"-06:00",name:"U.S. Central Standard Time"},{offset:"-06:00",name:"U.S. Mountain Daylight Time"},{offset:"-05:00",name:"U.S. Eastern Standard Time"},{offset:"-05:00",name:"U.S. Central Daylight Time"},{offset:"-04:00",name:"U.S. Atlantic Standard Time"},{offset:"-04:00",name:"U.S. Eastern Daylight Time"},{offset:"-03:30",name:"Newfoundland Standard Time"},{offset:"-03:00",name:"Brazil Standard Time"},{offset:"-03:00",name:"Atlantic Daylight Time"},{offset:"-03:00",name:"Greenland Standard Time"},
{offset:"-02:00",name:"Azores Time"},{offset:"-01:00",name:"West Africa Time"},{offset:"00:00",name:"Greenwich Mean Time/UTC"},{offset:"00:00",name:"Western European Time"},{offset:"01:00",name:"Central European Time"},{offset:"01:00",name:"Middle European Time"},{offset:"01:00",name:"British Summer Time"},{offset:"01:00",name:"Middle European Winter Time"},{offset:"01:00",name:"Swedish Winter Time"},{offset:"01:00",name:"French Winter Time"},{offset:"02:00",name:"Eastean EU"},{offset:"02:00",name:"USSR-zone1"},
{offset:"02:00",name:"Middle European Summer Time"},{offset:"02:00",name:"French Summer Time"},{offset:"03:00",name:"Baghdad Time"},{offset:"03:00",name:"USSR-zone2"},{offset:"03:30",name:"Iran"},{offset:"04:00",name:"USSR-zone3"},{offset:"05:00",name:"USSR-zone4"},{offset:"05:30",name:"Indian Standard Time"},{offset:"06:00",name:"USSR-zone5"},{offset:"06:30",name:"North Sumatra Time"},{offset:"07:00",name:"USSR-zone6"},{offset:"07:00",name:"West Australian Standard Time"},{offset:"07:30",name:"Java"},
{offset:"08:00",name:"China & Hong Kong"},{offset:"08:00",name:"USSR-zone7"},{offset:"08:00",name:"West Australian Daylight Time"},{offset:"09:00",name:"Japan"},{offset:"09:00",name:"Korea"},{offset:"09:00",name:"USSR-zone8"},{offset:"09:30",name:"South Australian Standard Time"},{offset:"09:30",name:"Central Australian Standard Time"},{offset:"10:00",name:"Guam Standard Time"},{offset:"10:00",name:"USSR-zone9"},{offset:"10:00",name:"East Australian Standard Time"},{offset:"10:30",name:"Central Australian Daylight Time"},
{offset:"10:30",name:"South Australian Daylight Time"},{offset:"11:00",name:"USSR-zone10"},{offset:"11:00",name:"East Australian Daylight Time"},{offset:"12:00",name:"New Zealand Standard Time"},{offset:"12:00",name:"Int'l Date Line East"},{offset:"13:00",name:"New Zealand Daylight Time"}];z.boil=F;z.unboil=B})(timeglider);(function(q){var F=q.levelHeight=12;q.TG_Org=function(){var B=this,o=q.icon_folder;this.blocks=[];this.ids=[];this.vis=[];this.tree=[];this.pol=-1;this.addBlock=function(u,f){u.right=u.left+u.width;u.bottom=u.top+u.height;u.tickScope=f;B.blocks.push(u)};this.getBorg=function(){return this};this.getBlocks=function(){return this.blocks};this.getHTML=function(u,f){if(u=="sweep"){G();this.vis=[]}this.blocks.sort(y);var D,z,e="",p="",r="",C=0,d={},j=this.blocks.length;z="";var n=0,A=0;D=100;D="";for(var a=
function(m){A=m>A?m:A},b=0;b<j;b++){d=this.blocks[b];n=0;D=100;D="";if(d.tickScope==u)if(_.indexOf(d.id,this.vis)==-1){this.vis.push(d.id);if(d.html&&d.html.substr(0,4)=="<div")r+="<div style='left:"+d.left+"px' id='"+d.id+"'"+d.html.substr(4);else{if(d.image){if(d.image.display_class!="above"){D=(d.image.scale||100)/100;if(D<1){d.image_width=D*d.image.width;d.image_height=D*d.image.height;D=" style='width:"+d.image_width+"px;height:auto' "}else{D="";d.image_width=d.image.width;d.image_height=d.image.height}n=
d.image_height+4}else D="";e="<div class='timeglider-event-image-"+d.image.display_class+"'><img src='"+d.image.src+"' "+D+"></div>"}else e="";if(d.y_position>0)d.top=B.pol*d.y_position;else v(d,0);a(Math.abs(d.top));z=d.span_color?";background-color:"+d.span_color:"";d.fontsize<10?d.opacity=d.fontsize/10:d.opacity=1;if(d.span==true){D="timeglider-event-spanning";z="<div class='timeglider-event-spanner' style='top:px;height:"+d.fontsize+"px;width:"+d.spanwidth+"px"+z+"'></div>"}else z=D="";p=d.icon?
"<img class='timeglider-event-icon' src='"+o+d.icon+"' style='height:"+d.fontsize+"px;left:-"+(d.fontsize+2)+"px; top:"+n+"px'>":"";if(f&&B.pol==-1&&Math.abs(d.top)>f-16)r+="<div class='timeglider-more-plus' style='left:"+d.left+"px; top:-"+(f-Math.floor(16/3))+"px'>+</div>";else{C=B.pol===1?42:0;r+="<div class='timeglider-timeline-event "+d.css_class+" "+D+"' id='"+d.id+"' style='width:"+d.width+"px;height:"+d.height+"px;left:"+d.left+"px;opacity:"+d.opacity+";top:"+(d.top+C)+"px;font-size:"+d.fontsize+
"px;'>"+p+e+z+"<div class='timeglider-event-title' style='top:"+n+"px'>"+d.title+"</div></div>"}}}}return{html:r,highest:A}};var G=function(){B.tree=[];for(var u=0;u<300;u++)B.tree[u]=[]},y=function(u,f){var D=f.importance,z=u.importance;return D<z?-1:D>z?1:0},v=function(u,f){var D=false,z=B.tree,e=z[f],p=f+1,r=false,C=2;if(e!=undefined){for(C=0;C<e.length;C++){a:{D=e[C];if(!(u.left>D.right||u.right<D.left))if(u.left>=D.left&&u.left<=D.right||u.right>=D.left&&u.right<=D.right||u.right>=D.right&&u.left<=
D.left||u.right<=D.right&&u.left>=D.left)if(u.bottom<=D.bottom&&u.bottom>=D.top||u.top<=D.bottom&&u.top>=D.top||u.top==D.bottom&&u.top==D.top){D=true;break a}D=false}if(D==true){if(B.pol===-1){u.top-=F;u.bottom-=F}else{u.top+=F;u.bottom+=F}v(u,p);r=true;break}}if(r==false){if(B.pol===-1)u.top-=u.fontsize;else u.top+=u.fontsize;e.push(u);if(typeof u.shape==="object"){p=e=r=p=0;p=Math.ceil(u.shape.ev_ht/F);for(r=1;r<=p;r++){e=f+r;e<=300&&z[e].push(u)}r=Math.ceil(u.shape.img_ht/F);C={left:u.left,right:u.left+
u.image.width+32,top:u.top,bottom:u.bottom};for(D=1;D<=r;D++){p=e+D;p<=300&&z[p].push(C)}}else{C=Math.ceil(u.height/F);for(r=1;r<=C;r++){p=f+r;p<=300?z[f+r].push(u):debug.log("too many levels!")}}}}}}})(timeglider);(function(q){var F=q.TG_Date,B=jQuery,o=F.units,G;q.TG_EventCollection=Backbone.Collection.extend({eventHash:{},setTimelineHash:function(y,v){this.eventHash[y]=v},getTimelineHash:function(y){return this.eventHash[y]},model:q.TG_Event});q.TG_Event=Backbone.Model.extend({urlRoot:"/event",defaults:{title:"Untitled"},initialize:function(y){if(y.image){if(typeof y.image=="string")y.image={id:y.id,src:y.image,display_class:y.image_class||"above",width:0,height:0};else{y.image.display_class=y.image.display_class||
"above";y.image.width=0;y.image.height=0}this.getEventImageSize(y.image)}else y.image="";y.titleWidth=q.getStringWidth(y.title);this.set(y)},validate:function(){},getEventImageSize:function(y){function v(D,z){return function(){return z.apply(D,arguments)}}var u=this,f=new Image;f.src=y.src;f.onerror=v(f,function(){});f.onload=v(f,function(){u.get("image").height=this.height;u.get("image").width=this.width})}});q.TG_TimelineCollection=Backbone.Collection.extend({model:q.TG_Timeline});q.TG_Timeline=
Backbone.Model.extend({urlRoot:"/timeline",defaults:{initial_zoom:25,timezone:"00:00",title:"Untitled",events:[],legend:[]},_chewTimeline:function(y){G=y.mediator;y.timeline_id=y.id;var v={all:[],da:[],mo:[],ye:[],de:[],ce:[],thou:[],tenthou:[],hundredthou:[],mill:[],tenmill:[],hundredmill:[],bill:[]};y.spans={};y.hasImagesAbove=false;y.startSeconds=[];y.endSeconds=[];y.size_importance=y.size_importance=="false"?false:true;y.timeOffset=F.getTimeOffset(y.timezone||"00:00");if(!y.color)y.color="#333333";
if(y.events.length>0){for(var u,f,D,z,e=y.events.length,p=0;p<e;p++){f=y.events[p];if(f.id)D=f.id;else f.id=D="anon"+this.anonEventId++;if(f.map)if(G.main_map){if(timeglider.mapping.ready)f.map.marker_instance=timeglider.mapping.addAddMarkerToMap(f,G.main_map)}else q.googleMapsLoad();u=f.date_display||f.date_limit||"da";f.date_display=u.toLowerCase().substr(0,2);if(y.timeOffset.seconds){f.startdate=F.tzOffsetStr(f.startdate,y.timeOffset.string);if(f.enddate)f.enddate=F.tzOffsetStr(f.enddate,y.timeOffset.string)}f.startdateObj=
new F(f.startdate,f.date_display);if(f.enddate&&f.enddate!==f.startdate){f.enddateObj=new F(f.enddate,f.date_display);f.span=true;y.spans["s_"+f.id]={id:f.id,start:f.startdateObj.sec,end:f.enddateObj.sec}}else{f.enddateObj=f.startdateObj;f.span=false}if(f.image)if(f.image.display_class!="inline")y.hasImagesAbove=true;y.startSeconds.push(f.startdateObj.sec);y.endSeconds.push(f.enddateObj.sec);f.cache={span:f.span,startdateObj:_.clone(f.startdateObj),enddateObj:_.clone(f.enddateObj)};f.icon=!f.icon||
f.icon==="none"?"":f.icon;v.all.push(D);for(var r=o.length,C=0;C<r;C++){u=o[C];z=F.getTimeUnitSerial(f.startdateObj,u);if(v[u][z]!==undefined)v[u][z].push(D);else v[u][z]=[D]}if(G.eventCollection.get(D))G.eventCollection.get(D).get("timelines").push(y.timeline_id);else{f.timelines=[y.timeline_id];f=new q.TG_Event(f);G.eventCollection.add(f)}}e=B.merge(y.startSeconds,y.endSeconds);e=_.sortBy(e,function(d){return parseInt(d)});y.bounds={first:_.first(e),last:_.last(e)};y.has_events=true;e=F.getDateFromSec(y.bounds.first);
debug.log("date from sec");y.focus_date=y.focus_date||e;y.focusDateObj=new F(y.focus_date);debug.log("tdata.focusDateObj:",y.focusDateObj)}else{y.has_events=false;y.focus_date=y.focus_date||"today";debug.log("hello today 357?")}y.hasLegend=y.legend.length>0?true:false;y.display="expanded";G.eventCollection.setTimelineHash(y.timeline_id,v);delete y.events;return y},initialize:function(y){y=this._chewTimeline(y);debug.log("processed:",y);this.set(y);this.bind("change",function(){})}})})(timeglider);(function(q){var F=q.TG_Date,B="",o="",G={},y=0,v=0,u=0,f=jQuery,D={},z="",e,p,r,C=f.support.touch?"touchstart":"click";q.TG_PlayerView=function(d,j){var n=this;o=j;G=o.options;B="#"+d._id;z=d._id;this._views={PLACE:B,CONTAINER:B+" .timeglider-container",DATE:B+" .timeglider-date-display",TIMELINE_MENU:B+" .timeglider-timeline-menu",TIMELINE_MENU_UL:B+" .timeglider-timeline-menu ul",TIMELINE_LIST_BT:B+" .timeglider-list-bt",SLIDER_CONTAINER:B+" .timeglider-slider-container",SLIDER:B+" .timeglider-slider",
ZOOM_DISPLAY:B+" .timeglider-zoomlevel-display",TRUCK:B+" .timeglider-truck",CENTERLINE:B+" .timeglider-centerline",TICKS:B+" .timeglider-ticks",HANDLE:B+" .timeglider-handle",FOOTER:B+" .timeglider-footer",FILTER_BT:B+" .timeglider-filter-bt",FILTER_BOX:B+" .timeglider-filter-box",SETTINGS_BT:B+" .timeglider-settings-bt"};e=this._views.CONTAINER;p=this._views.TICKS;r=this._views.DATE;this.initTimelineVOffset=100;this.tick_height=34;this.imageLaneHeight=60;this._templates={};this._templates={test:"testola",
event_modal_small:"<div class='tg-modal timeglider-ev-modal ui-widget-content' id='${id}_modal'><div class='close-button-remove'></div><div class='dateline'>{{html dateline}}</div><h4 id='title'>${title}</h4><p>{{html image}}{{html description}}</p><ul class='timeglider-ev-modal-links'>{{html links}}</ul></div>",event_modal_full:f.template(null,"<div class='tg-modal full_modal' id='ev_${id}_modal'><div class='full_modal_scrim'></div><div class='full_modal_panel'><div class='close-button full_modal_close'>x</div><div class='dateline'>{{html dateline}}</div><table><tr><td><h4>${title}</h4><div class='description'><p>{{html description}}</p></div></td><td><div>{{html image}}</div><div id='insert'></div></td></tr></table><div class='footer'><ul>{{html links}}</ul></div></div>"),
filter_modal:f.template(null,"<div class='tg-modal timeglider-menu-modal timeglider-filter-box'><div class='close-button'></div><h3>filter</h3><div class='timeglider-menu-modal-content'><div class='timeglider-formline'>show: <input type='text' class='timeglider-filter-include'></div><div class='timeglider-formline'>hide: <input type='text' class='timeglider-filter-exclude'></div><ul><li class='timeglider-filter-clear'>clear</li><li class='timeglider-filter-apply'>apply</li></ul></div><div class='timeglider-menu-modal-point-right'></div>"),
timeline_list_modal:f.template(null,"<div class='timeglider-menu-modal timeglider-timeline-menu'><div class='close-button'></div><h3>timelines</h3><div class='timeglider-menu-modal-content'><ul></ul></div><div class='timeglider-menu-modal-point-right'></div>"),settings_modal:f.template(null,"<div class='timeglider-menu-modal timeglider-settings-modal'><div class='close-button'></div><h3>settings</h3><div class='timeglider-menu-modal-content'><div class='timeglider-settings-timezone'></div></div><div class='timeglider-menu-modal-point-right'></div>"),
legend_modal:f.template(null,"<div class='timeglider-menu-modal timeglider-legend timeglider-display-none'  id='${id}_legend'><div class='timeglider-menu-modal-content'><ul id='${id}'>{{html legend_list}}</ul><div class='timeglider-close-button-small timeglider-legend-close'></div><div class='timeglider-legend-all'>all</div></div></div>")};this.timelineModal=q.TG_TimelineView.extend({tagName:"div",model:q.TG_Timeline,className:"tg-modal timeglider-timeline-modal ui-widget-content",events:{"click .close-button-remove":"remove"},
template:"<div class='close-button-remove'></div><h4 id='title'>${title}</h4><p>{{html description}}</p>",initialize:function(){this.model.bind("change",this.render,this)},render:function(){f(this.el).html(f.tmpl(this.template,this.model.attributes)).attr("id",this.model.get("id")+"_timelineModal");return this},remove:function(){f(this.el).fadeOut()}});f(e).delegate(".tg-timeline-envelope .timeline-info","click",function(){var a=f(this).data("timeline_id");n.openTimelineModal(a)}).delegate(".tg-timeline-envelope .expand-collapse",
"click",function(){var a=f(this).data("timeline_id");n.expandCollapseTimeline(a)}).delegate(".tg-timeline-envelope .tg-timeline-legend-bt","click",function(){var a=f(this).data("timeline_id");n.legendModal(a)}).delegate(".close-button-remove","click",function(){var a=f(this).parent().attr("id");f("#"+a).remove()}).delegate(".full_modal_scrim, .full_modal_close","click",function(){f(".full_modal").remove()}).delegate(".timeglider-more-plus","click",function(){o.zoom(-1)}).delegate(".timeglider-legend-close",
"click",function(){var a=f(e+" .timeglider-legend");a.fadeOut(300,function(){a.remove()})}).delegate(".timeglider-legend-all","click",function(){f(e+" .timeglider-legend li").each(function(){f(this).removeClass("tg-legend-icon-selected")});o.setFilters({origin:"legend",icon:"all"})}).css("height",f(B).height());this.basicFontSize=G.basic_fontsize;G.show_footer==false&&f(this._views.FOOTER).css("display","none");this.dragSpeed=0;this.dimensions=o.dimensions=this.getWidgetDimensions();this.ticksHandleOffset=
this.rightside=this.leftside=this.tickNum=0;this.timeoout_id=1;this.sliderActive=false;this.ztop=1E3;this.filterBoxActivated=false;this.buildSlider();this.setupFilter();this.setPanButton(f(".timeglider-pan-right"),-30);this.setPanButton(f(".timeglider-pan-left"),30);f(this._views.TRUCK).bind("dblclick",function(a){o.registerUIEvent({name:"dblclick",event:a,dimensions:n.dimensions})}).bind("mousewheel",function(a,b){var m=Math.ceil(-1*b*3),g=o.getZoomLevel();o.setZoomLevel(g+m);return false});f(p).draggable({axis:"x",
start:function(){},drag:function(){v=Math.floor(f(this).position().left);o.setTicksOffset(v);y=v-u;u=v},stop:function(){n.resetTicksHandle();n.registerDragging()}}).delegate(e+" .timeglider-timeline-event",C,function(){var a=f(this).attr("id"),b=o.eventCollection.get(a).attributes;if(timeglider.mode!="authoring")if(b.click_callback){a=b.click_callback.split(".");var m=a.length;if(m==1)window[a[0]](b);else if(m==2)window[a[0]][a[1]](b);else if(m==3)window[a[0]][a[1]][a[2]](b)}else n.eventModal(a)}).delegate(".timeglider-timeline-event",
"mouseover",function(){var a=o.eventCollection.get(f(this).attr("id")).attributes;n.eventHover(f(this),a)}).delegate(".timeglider-timeline-event","mouseout",function(){var a=o.eventCollection.get(f(this).attr("id")).attributes;n.eventUnHover(f(this),a)}).delegate(".timeglider-event-collapsed","hover",function(){o.eventCollection.get(f(this).attr("id"))});n.setCenterline();f.subscribe("mediator.ticksOffsetChange",function(){n.tickHangies();n.registerDragging();n.registerTitles()});f.subscribe("mediator.focusToEvent",
function(){});f.subscribe("mediator.zoomLevelChange",function(){n.tickNum=0;n.leftside=0;var a=o.getZoomLevel();f(n._views.SLIDER).slider("value",n.invSliderVal(a));n.displayZoomLevel(a);n.castTicks("zoomLevelChange")});f.subscribe("viewer.rendered",function(){});f.subscribe("mediator.ticksReadySignal",function(){o.ticksReady===true&&n.freshTimelines()});f.subscribe("mediator.refreshSignal",function(){n.tickNum=0;n.leftside=0;n.castTicks("refreshSignal")});f.subscribe("mediator.ticksArrayChange",
function(){});f.subscribe("mediator.focusDateChange",function(){this.displayFocusDate()});f.subscribe("mediator.timelineDataLoaded",function(){f(".timeglider-loading").fadeOut(500);n.buildSettingsMenu();n.buildTimelineMenu()});f.subscribe("mediator.activeTimelinesChange",function(){f(n._views.TIMELINE_MENU_UL+" li").each(function(){var a=f(this).data("timeline_id");f.inArray(a,o.activeTimelines)!=-1?f(this).addClass("activeTimeline"):f(this).removeClass("activeTimeline")})});f.subscribe("mediator.filterChange",
function(){});if(f.support.touch){f("#"+z).addTouch();var A=document.getElementById(z);A.addEventListener("gesturestart",function(a){a.preventDefault();f("#output").append("<br>gesture zoom:"+o.getZoomLevel())},false);A.addEventListener("gestureend",function(a){a.preventDefault();f("#output").append("<br>gesture end:"+o.getZoomLevel())},false);A.addEventListener("gesturechange",function(a){a.preventDefault();a.preventDefault();if(o.gesturing===false){o.gesturing=true;o.gestureStartZoom=o.getZoomLevel()}o.setZoomLevel(Math.ceil(o.gestureStartZoom/
a.scale))},false)}};q.TG_PlayerView.prototype={resize:function(){var d=f(B).height();f(e).height(d);this.dimensions=this.getWidgetDimensions();o.setDimensions(this.dimensions);this.setCenterline();o.refresh()},getWidgetDimensions:function(){var d=f(e),j=d.width(),n=Math.floor(j/2)+1,A=d.height(),a=Math.floor(A/2),b=this.tick_height,m=d.position().left;d=d.offset();var g=G.show_footer==true?f(this._views.FOOTER).height():0;return{container:{width:j,height:A,centerx:n,centery:a,left:m,offset:d},tick:{top:A-
g-b},footer:{height:g}}},scaleToImportance:function(d,j){return d/j},displayZoomLevel:function(){var d=o.getZoomLevel();d>0&&G.display_zoom_level==true&&f(this._views.ZOOM_DISPLAY).text(d)},displayFocusDate:function(){var d=o.getFocusDate();f(r).text(d.format("d MMM yyyy",false))},setPanButton:function(d,j){var n=this;f(d).live("mousedown",function(){n.intervalMachine("pan",{type:"set",fn:n.pan,args:[j],intvl:33})}).live("mouseup",function(){n.intervalMachine("pan",{type:"clear",fn:n.pan,callback:"resetTicksHandle"})}).live("mouseout",
function(){n.intervalMachine("pan",{type:"clear",fn:n.pan,callback:"resetTicksHandle"})})},intervalMachine:function(d,j){var n=this;if(j.type==="clear"){clearInterval(D[d]);if(j.callback)n[j.callback]()}else D[d]=setInterval(function(){j.fn.apply(n,j.args)},j.intvl)},invSliderVal:function(d){return Math.abs(d-101)},pan:function(d){var j=d||20;d=f(p);j=d.position().left+j;d.css({left:j});o.setTicksOffset(j)},registerTitles:function(){var d,j,n,A,a,b,m,g,k,h,s,t=f(e).offset().left;f(".timeglider-event-spanning").each(function(){d=
f(this).offset().left-t;j=f(this).outerWidth();b=f(".timeglider-event-title",this);n=b.outerWidth()+5;A=b.siblings(".timeglider-event-spanner").outerWidth();A>n&&d<0&&Math.abs(d)<j-n&&b.css({marginLeft:-1*d+5})});f.browser.msie&&parseInt(f.browser.version);f(".tg-timeline-envelope").each(function(){m=f(this);g=m.offset().left-t;k=m.find(".titleBar");a=k.data("lef");s=-1*(a+g);h=k.find(".timeline-title");s>0&&s<k.width()-h.width()&&h.css({marginLeft:s+5})})},registerDragging:function(){var d=o.startSec,
j=f(p).position().left,n=o.getZoomInfo().spp;d=new F(d-j*n);o.setFocusDate(d);this.displayFocusDate()},setupFilter:function(){var d=this,j=f.tmpl(d._templates.filter_modal,{}).appendTo(d._views.CONTAINER);j.css("z-index",d.ztop++).position({my:"right bottom",at:"right top",of:f(d._views.FILTER_BT),offset:"-8, -12"}).hide();f(e).delegate(".timeglider-filter-box .close-button","click",function(){j.fadeOut()});f(d._views.FILTER_BT).bind("click",function(){j.fadeIn();f(this);var n=d._views.FILTER_BOX;
if(d.filterBoxActivated==false){d.filterBoxActivated=true;var A=f(n+" .timeglider-filter-apply"),a=f(".timeglider-filter-box .close-button"),b=f(n+" .timeglider-filter-clear"),m="",g="";A.bind("click",function(){m=f(n+" .timeglider-filter-include").val();g=f(n+" .timeglider-filter-exclude").val();o.setFilters({origin:"clude",include:m,exclude:g});f(n).toggleClass("timeglider-display-block")});a.bind("click",function(){f(n).toggleClass("timeglider-display-none")});b.bind("click",function(){o.setFilters({origin:"clude",
include:"",exclude:""});f(n+" .timeglider-filter-include").val("");f(n+" .timeglider-filter-exclude").val("");f(n).toggleClass("timeglider-display-block")})}})},buildTimelineMenu:function(){var d=this,j;f(d._views.TIMELINE_LIST_BT);f(d._views.TIMELINE_MENU)[0]&&f(d._views.TIMELINE_MENU).remove();j=f.tmpl(d._templates.timeline_list_modal,{}).appendTo(d._views.CONTAINER);var n=Backbone.View.extend({initialize:function(){this.model.bind("change",this.render,this)},tagName:"li",className:"timeglider-timeline-list-item",
template:"${title}",events:{click:"toggleTimeline"},toggleTimeline:function(){o.toggleTimeline(this.model.get("id"))},render:function(){var A=this.model.get("id");f(this.el).html(f.tmpl(this.template,this.model.attributes)).data("timeline_id",A);return this}});f(d._views.TIMELINE_MENU_UL).html("");_.each(o.timelineCollection.models,function(A){f(d._views.TIMELINE_MENU_UL).append((new n({model:A})).render().el)});j.position({my:"right bottom",at:"right top",of:f(d._views.TIMELINE_LIST_BT),offset:"-8, -12"}).hide();
f(e).delegate(".timeglider-timeline-menu .close-button","click",function(){j.fadeOut()}).delegate(this._views.TIMELINE_LIST_BT,"click",function(){j.fadeIn()})},getTimezonePulldown:function(d,j){var n="<select name='timezone' id='"+d+"'>",A=false,a="selected";f.map(F.timezones,function(b){if(j==b.offset&&A==false){a="selected";A=true}else a="";n+="<option value='"+b.offset+"' "+a+">"+b.name+"</option>"});n+="</select>";return n},buildSettingsMenu:function(){var d=f.tmpl(this._templates.settings_modal,
{}).appendTo(this._views.CONTAINER),j=this.getTimezonePulldown("timeglider-settings-timezone",o.timeOffset.string);d.find(".timeglider-settings-timezone").append('<p>Make changes below, then click on "save". More settings options to come!</p>').append('<span class="settings-label">timezone:</span> '+j).append("<p style='clear:both'>&nbsp;</p><div class='btn success' id='timeglider-settings-save'>save</div>");d.position({my:"right bottom",at:"right top",of:f(this._views.SETTINGS_BT),offset:"-8, -12"}).hide();
f(e).delegate(".timeglider-settings-modal .close-button","click",function(){d.fadeOut()}).delegate(this._views.SETTINGS_BT,"click",function(){d.fadeIn()}).delegate("#timeglider-settings-save","click",function(){var n=f(e+" #timeglider-settings-timezone").val();o.setTimeoffset(n)})},buildSlider:function(){var d=o.getZoomLevel();if(G.min_zoom==G.max_zoom)f(this._views.SLIDER_CONTAINER).css("display","none");else{G.display_zoom_level==true&&f("<div>").appendTo(this._views.SLIDER_CONTAINER).addClass("timeglider-zoomlevel-display").html("&nbsp;");
var j=this;d=j.invSliderVal(d);var n=o.max_zoom,A=o.min_zoom;f(this._views.SLIDER).css("height",(1+n-A)*3).slider({steps:100,handle:f(".knob"),animate:300,orientation:"vertical",min:j.invSliderVal(n),max:j.invSliderVal(A),value:d,start:function(){j.sliderActive=true},stop:function(){j.sliderActive=false},change:function(){},slide:function(a,b){o.setZoomLevel(j.invSliderVal(b.value))}})}},getEventDateLine:function(d){var j="<span class='timeglider-dateline-startdate'>"+d.startdateObj.format("",true,
o.timeOffset)+"</span>",n="";if(d.span==true)n=" &ndash; <span class='timeglider-dateline-enddate'>"+d.enddateObj.format("",true,o.timeOffset)+"</span>";return j+n},eventHover:function(d,j){var n=f(".timeglider-event-hover-info");j.date_display!="no"&&n.position({my:"left bottom",at:"left top",of:d,offset:"1, -10",collision:"flip flip"}).html(this.getEventDateLine(j));d.addClass("tg-event-hovered")},eventUnHover:function(d){f(".timeglider-event-hover-info").css("left","-1000px");d.removeClass("tg-event-hovered")},
clearTicks:function(){this.tickNum=this.leftside=0;f(p).css("left",0);f(e+" .tg-timeline-envelope").remove();f(e+" .timeglider-tick").remove()},castTicks:function(){this.clearTicks();o.getZoomLevel();var d=o.getFocusDate(),j=o.getZoomInfo().width;j=Math.ceil(this.dimensions.container.width/j)+4;var n="l";o.setTicksReady(false);this.addTick({type:"init",focus_date:d});for(d=1;d<=j;d+=1){this.addTick({type:n});n=n=="l"?"r":"l"}o.setTicksReady(true);this.displayFocusDate()},addTick:function(d){var j=
0,n=0,A=n=0,a=0,b=0,m=b="",g={};b={};A={};var k={};b={};g="";k=o.getZoomInfo().unit;var h=o.getZoomInfo().width;a=o.getFocusDate();A=parseInt(this.dimensions.tick.top);a=o.addToTicksArray({type:d.type,unit:k},a);if(k=="mo"){b=F.getMonthAdj(a,h);h=b.width;j=b.days}this.tickNum++;if(d.type=="init"){b=this.tickOffsetFromDate(o.getZoomInfo(),o.getFocusDate(),h);this.leftside=n=Math.ceil(this.dimensions.container.centerx+b);this.rightside=n+h}else if(d.type=="l")this.leftside=n=Math.floor(this.leftside-
h);else if(d.type=="r"){n=Math.floor(this.rightside);this.rightside+=h}o.getTickBySerial(a).width=h;o.getTickBySerial(a).left=n;b=this._views.PLACE+"_"+k+"_"+a+"-"+this.tickNum;b=f("<div class='timeglider-tick' id='"+b+"'><div class='timeglider-tick-label' id='label'></div></div>").appendTo(p);b.css({width:h,left:n,top:A});A=this.getTickMarksInfo({unit:k,width:h});A=j||A.tperu;n=h/A;if(n>5)for(d=j=0;d<A;d++){m="&nbsp;";if(n>16)if(k=="da")m=this.getHourLabelFromHour(d,n);else if(k=="mo")m=d+1;else if(k==
"ye")m=n>30?"&nbsp;"+F.monthNamesAbbr[d+1]:"&nbsp;"+F.monthNamesLet[d+1];else if(k=="de"){if(n>44)m=a+""+d}else if(k=="ce")if(n>28)m=a+""+d+"0";g+="<div class='timeglider-tick-sub-label' style='left:"+j+"px;width:"+n+"px'>"+m+"</div>";j+=n}g&&b.append("<div style='background-color:none;height:24px;width:"+(h+10)+"px;position:absolute;top:15px;left:0;overflow:hidden'>"+g+"</div>");k={unit:k,width:h,serial:a};g=this.getDateLabelForTick(k);b.children("#label").text(g);return k},setCenterline:function(){o.options.show_centerline===
true?f(this._views.CENTERLINE).css({height:this.dimensions.container.height,left:this.dimensions.container.centerx}):f(this._views.CENTERLINE).css({display:"none"})},getHourLabelFromHour:function(d,j){var n="",A=d,a="";a=0;if(j<16)return"";else{if(d>12)A=d-12;else if(d==0)A=12;if(j>30)n=d>11?" pm":" am";if(j>200){a=j/4-4;return"<div class='minutes' style='width:"+a+"px'>"+A+":00 "+n+"</div><div class='minutes' style='width:"+a+"px'>"+A+":15 "+n+"</div><div class='minutes' style='width:"+a+"px'>"+
A+":30 "+n+"</div><div class='minutes' style='width:"+a+"px'>"+A+":45 "+n+"</div>"}else return A+(j>60?":00":"")+n}},getTickMarksInfo:function(d){switch(d.unit){case "da":d=24;break;case "mo":d=30;break;case "ye":d=12;break;default:d=10}return{tperu:d}},getDateLabelForTick:function(d){var j=d.serial,n=d.width;switch(d.unit){case "bill":return j==0?"1":j>0?j+" billion":j+" b.y. bce";case "hundredmill":return j==0?"1":j>0?j+"00 million":j+"00 m.y. bce";case "tenmill":return j==0?"1":j>0?j+"0 million":
j+"0 m.y. bce";case "mill":return j==0?"1":j>0?j+" million":j+" m.y. bce";case "hundredthou":return j==0?"1":j>0?j+"00,000":j+"00,000 bce";case "tenthou":return j==0?"1":j>0?j+"0,000":j+"0,000 bce";case "thou":return j==0?"1("+j+")":j>0?j+"000":j+"000 bce";case "ce":return j==0?"1("+j+")":j>0?j+"00":j+"00 bce";case "de":return j>120?j*10+"s":j*10;case "ye":return j;case "mo":d=F.getDateFromMonthNum(j);return n<120?F.monthNamesAbbr[d.mo]+" "+d.ye:F.monthNames[d.mo]+", "+d.ye;case "da":d=new F(F.getDateFromRD(j));
return n<120?F.monthNamesAbbr[d.mo]+" "+d.da+", "+d.ye:F.monthNames[d.mo]+" "+d.da+", "+d.ye;default:return d.unit+":"+j+":"+n}},tickHangies:function(){var d=f(p).position().left,j=this.rightside+d-this.dimensions.container.width;if(this.leftside+d>-100){d=this.addTick({type:"l"});this.appendTimelines(d)}else if(j<100){d=this.addTick({type:"r"});this.appendTimelines(d)}},tickOffsetFromDate:function(d,j,n){switch(d.unit){case "da":j=j.ho/24+j.mi/1440;n*=j;break;case "mo":d=F.getMonthDays(j.mo,j.ye);
j=(j.da-1)/d+j.ho/(24*d)+j.mi/(1440*d);n*=j;break;case "ye":j=((j.mo-1)*30+j.da)/365;n*=j;break;case "de":j=j.ye%10/10+j.mo/120;n*=j;break;case "ce":j=j.ye%100/100+j.mo/1200;n*=j;break;case "thou":j=j.ye%1E3/1E3;n*=j;break;case "tenthou":j=j.ye%1E4/1E4;n*=j;break;case "hundredthou":j=j.ye%1E5/1E5;n*=j;break;default:n=0}return-1*n},resetTicksHandle:function(){f(this._views.HANDLE).offset({left:f(e).offset().left})},easeOutTicks:function(){Math.abs(y)>5&&f(p).animate({left:"+="+3*y},1E3,"easeOutQuad",
function(){debug.trace("stopping easing","note")})},getTimelineEventsByTick:function(d){var j=d.tick.unit,n=d.tick.serial;d=o.eventCollection.getTimelineHash(d.timeline.timeline_id);return d[j][n]&&d[j][n].length>0?d[j][n]:0},passesFilters:function(d,j){var n=true,A="",a=[],b;A="";a=[];if(j<d.low_threshold||j>d.high_threshold)return false;if(A=o.filters.include){a=A.split(",");n=false;for(b=0;b<a.length;b++){A=RegExp(f.trim(a[b]),"i");if(d.title.match(A))n=true}}if(A=o.filters.exclude){a=A.split(",");
for(b=0;b<a.length;b++){A=RegExp(f.trim(a[b]),"i");if(d.title.match(A))n=false}}A=d.icon;if(o.filters.legend.length>0)if(f.inArray(A,o.filters.legend)==-1)n=false;return n},freshTimelines:function(){var d=this,j,n,A,a=o.activeTimelines,b=o.ticksArray,m="",g,k;n="";var h=d.dimensions.container.centerx;j=d.dimensions.container.width;var s=o.getFocusDate().sec,t=o.getZoomInfo().spp;o.getZoomInfo();n=[];var x=[],c=s-Math.floor(t*(j/2));A=g=0;for(var i,l=0,w=d.dimensions.container.height,E=l=0;E<a.length;E++){x=
[];n=o.timelineCollection.get(a[E]);j=n.attributes;i=j.display;l=j.top?parseInt(j.top.replace("px","")):w-d.initTimelineVOffset;n=new q.TG_TimelineView({model:n});g=o.timeOffset.seconds/t;k=f(n.render().el).appendTo(p);k.draggable({axis:"y",handle:".titleBar",stop:function(){var H=f(this).css("top"),I=f(this).attr("id");o.timelineCollection.get(I).set({top:H});o.refresh()}}).css({top:l,left:g});g=k.find(".titleBar");if(typeof j.bounds!="undefined"){n=h+(j.bounds.first-s)/t;A=h+(j.bounds.last-s)/t}else{n=
h;A=h+300}A-=n;g.css({top:void 0,left:n,width:A}).data({lef:n,wid:A});if(i=="expanded")j.borg=m=new timeglider.TG_Org;for(g=0;g<b.length;g++){n=this.getTimelineEventsByTick({tick:b[g],timeline:j});f.merge(x,n)}_.each(j.spans,function(H){H.start<c&&H.end>c&&f.inArray(H.id,x)==-1&&x.unshift(H.id)});n=this.compileTickEventsAsHtml(j,x,0,"sweep");l=G.event_overflow=="scroll"?0:j.hasImagesAbove?l-d.imageLaneHeight:l;if(i=="expanded"){n=m.getHTML("sweep",l);j.borg=m.getBorg()}n!="undefined"&&k.append(n.html);
setTimeout(function(){d.registerEventImages(k)},3)}d.registerTitles();f.publish("viewer.rendered")},appendTimelines:function(d){var j=o.activeTimelines,n=[],A;n="";for(var a=0;a<j.length;a++){A=o.timelineCollection.get(j[a]).attributes;debug.log("tl id:",A.id);n=this.getTimelineEventsByTick({tick:d,timeline:A});n=this.compileTickEventsAsHtml(A,n,d.serial,"append");if(A.display=="expanded")n=A.borg.getHTML(d.serial,A.top);A=f(e+" .tg-timeline-envelope#"+A.id).append(n.html);this.registerEventImages(A)}f.publish("viewer.rendered")},
compileTickEventsAsHtml:function(d,j,n,A){var a=0,b=this.dimensions.container.centerx,m=d.display,g="",k=o.startSec,h=o.getZoomInfo().spp,s=o.getZoomInfo().level;a=0;var t=d.borg,x={},c="sweep";if(A=="append")c=n;for(n=0;n<j.length;n++){x=o.eventCollection.get(j[n]).attributes;if(this.passesFilters(x,s)===true){a=b+(x.startdateObj.sec-k)/h;if(m=="expanded"){A=d.size_importance!==false?this.scaleToImportance(x.importance,s):1;x.width=x.titleWidth*A+20;x.fontsize=this.basicFontSize*A;x.left=a;x.spanwidth=
0;if(x.span==true){x.spanwidth=(x.enddateObj.sec-x.startdateObj.sec)/h;if(x.spanwidth>x.width)x.width=x.spanwidth}a=0;A=Math.ceil(x.fontsize);if(x.image&&x.image.display_class==="inline"){a=(x.image.scale||100)/100*x.image.height+2;x.width=x.image.width>x.width?x.image.width:x.width;x.shape={ev_ht:A,img_ht:a+32}}x.height=A+a;x.top=0-x.height;t.addBlock(x,c)}else if(m=="collapsed")g+="<div id='"+x.id+"' class='timeglider-event-collapsed' style='top:-2px;left:"+a+"px'></div>"}}return m=="collapsed"?
g:""},registerEventImages:function(d){f(e+" .timeglider-event-image-bar").each(function(){f(this).position({my:"top",at:"bottom",of:d,offset:"0, 0"}).css("left",0)});f(e+" .timeglider-event-image-above").each(function(){f(this).css("display","block").position({my:"top",at:"top",of:f(e),offset:"0, 12"}).css({left:0})})},expandCollapseTimeline:function(d){d=o.timelineCollection.get(d).attributes;d.display=d.display=="expanded"?"collapsed":"expanded";o.refresh()},openTimelineModal:function(d){d=new this.timelineModal({model:o.timelineCollection.get(d)});
f(d.render().el).appendTo("body").position({my:"left top",at:"left top",of:this._views.CONTAINER,offset:"32, 32",collision:"fit fit"}).css("z-index",this.ztop++).draggable({stack:".timeglider-modal"})},createEventLinksMenu:function(d){if(!d)return"";var j="",n=0,A="",a="";if(typeof d=="string")j="<li><a href='"+d+"' target='_blank'>link</a></li>";else if(typeof d=="object")for(n=0;n<d.length;n++){A=d[n].url;a=d[n].label;j+="<li><a href='"+A+"' target='_blank'>"+a+"</a></li>"}return j},eventModal:function(d){f(e+
" #"+d+"_modal").remove();var j=this,n=false,A=false,a="";a={};a=0;a=f("#"+d);var b=o.eventCollection.get(d).attributes,m=b.modal_type||G.event_modal.type,g=b.image&&b.image.src?"<img src='"+b.image.src+"'>":"",k=this.createEventLinksMenu(b.link);d={title:b.title,description:b.description,id:d,dateline:j.getEventDateLine(b),links:k,image:g};if(b.video){d.video=b.video;m="full";A=true;d.video=b.video}else if(b.map&&b.map.latlong){n=true;m="full"}switch(m){case "full":d=f.tmpl(j._templates.event_modal_full,
d);d.appendTo(e).css({"z-index":j.ztop++}).position({my:"left top",at:"left top",of:e,offset:"0, 0",collision:"none none"});if(n==true){d.find("#insert").append("<div id='map_modal_map'></div>");a=b.map.zoom||12;n=String(b.map.latlong).split(",");n=new google.maps.LatLng(parseFloat(n[0]),parseFloat(n[1]));a={zoom:a,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP};a=new google.maps.Map(f("#map_modal_map")[0],a);if(b.map.markers)for(n=0;n<b.map.markers.length;n++){A=b.map.markers[n];new google.maps.MarkerImage(A.image,
new google.maps.Size(24,32),new google.maps.Point(0,0),new google.maps.Point(0,32));d=A.latlong.split(",");d=new google.maps.LatLng(d[0],d[1]);A=new google.maps.Marker({position:d,map:a,icon:A.icon,title:A.title,zIndex:A.zIndex})}}else A==true&&d.find("#insert").append("<iframe width='100%' height='300' src='"+b.video+"'></iframe></div>");b=j.dimensions.container.height;n=j.dimensions.container.width;A=f(e+" .full_modal_panel");d=A.width();a=A.height();A.css({top:(b-a)/2+"px",left:(n-d)/2+"px"});
break;case "video":d=f.tmpl(j._templates.event_modal_video,d);d.appendTo(p).css("z-index",j.ztop++).position({my:"right center",at:"left center",of:a,offset:"-12, -1",collision:"flip fit"}).hover(function(){f(this).css("z-index",j.ztop++)});break;default:d=f.tmpl(j._templates.event_modal_small,d);d.appendTo(p).css("z-index",j.ztop++).position({my:"center top",at:"center top",of:e,offset:"0, 100",collision:"fit fit"}).draggable().hover(function(){f(this).css("z-index",j.ztop++)})}},legendModal:function(d){var j=
o.timelineCollection.get(d).attributes.legend,n=0,A="",a="",b="";n="";for(n=0;n<j.length;n++){A=G.icon_folder+j[n].icon;a=j[n].title;b+="<li><img class='legend-icon' src='"+A+"'><span class='legend-info'>"+a+"</span></li>"}d={id:d,legend_list:b};f(e+" .timeglider-legend").remove();f.tmpl(this._templates.legend_modal,d).appendTo(e).css("z-index",this.ztop++).toggleClass("timeglider-display-none").position({my:"left top",at:"left top",of:e,offset:"16, -4",collision:"none none"});n=timeglider.mode===
"authoring"?e+" .legend-info":e+" .legend-info, "+e+" .legend-icon";f(n).bind("mouseup",function(m){m=f(m.target).parent().children("img").attr("src");f(this).parent().toggleClass("tg-legend-icon-selected");o.setFilters({origin:"legend",icon:m})})},parseHTMLTable:function(d){var j={},n=+new Date,A=[];f("#"+d).find("tr").each(function(a){var b=f(this).children(),m;if(a===0)A=b.map(function(){return f(this).attr("class").replace(/^.*?\btg-(\S+)\b.*?$/,"$1")}).get();else{m={};b.each(function(g){m[A[g]]=
f(this).text()});j["prefix"+n++]=m}});return j}};q.TG_TimelineView=Backbone.View.extend({initialize:function(){var d=this;this.model.bind("change:title",function(){f(d.el).find(".timeline-title-span").text(d.model.get("title"))});this.model.bind("destroy",this.remove,this)},tagName:"div",events:{"click .timeline-title-span":"titleClick"},className:"tg-timeline-envelope",getTemplate:function(){var d="<div class='titleBar'><div class='timeline-title'><span class='timeline-title-span'>${title}</span><div class='tg-timeline-env-buttons'>";
if(this.model.get("description"))d+="<span class='timeline-info' data-timeline_id='${id}'>info</span>";if(this.model.get("hasLegend"))d+="<span class='tg-timeline-legend-bt' data-timeline_id='${id}'>legend</span>";d+="<span class='expand-collapse' data-timeline_id='${id}'>exp/col</span>";d+="</div></div></div>";return d},render:function(){this.model.get("id");this.model.get("title");var d=this.getTemplate();f(this.el).html(f.tmpl(d,this.model.attributes)).attr("id",this.model.get("id"));return this},
setText:function(){},titleClick:function(){o.timelineTitleClick(this.model.get("id"))},remove:function(){f(this.el).remove()}});q.zoomTree=[{},{unit:"da",width:35E3,level:1,label:"5 hours"},{unit:"da",width:17600,level:2,label:"7 hours"},{unit:"da",width:8800,level:3,label:"10 hours"},{unit:"da",width:4400,level:4,label:"12 hours"},{unit:"da",width:2200,level:5,label:"14 hours"},{unit:"da",width:1100,level:6,label:"17 hours"},{unit:"da",width:550,level:7,label:"22 hours"},{unit:"da",width:432,level:8,
label:"1 DAY"},{unit:"da",width:343,level:9,label:"1.5 days"},{unit:"da",width:272,level:10,label:"2 days"},{unit:"da",width:216,level:11,label:"2.5 days"},{unit:"da",width:171,level:12,label:"3 days"},{unit:"da",width:136,level:13,label:"3.5 days"},{unit:"da",width:108,level:14,label:"4 days"},{unit:"mo",width:2509,level:15,label:"6 days"},{unit:"mo",width:1945,level:16,label:"1 WEEK"},{unit:"mo",width:1508,level:17,label:"10 days"},{unit:"mo",width:1169,level:18,label:"2 weeks"},{unit:"mo",width:913,
level:19,label:"2.5 weeks"},{unit:"mo",width:719,level:20,label:"3 weeks"},{unit:"mo",width:566,level:21,label:"3.5 weeks"},{unit:"mo",width:453,level:22,label:"1 MONTH"},{unit:"mo",width:362,level:23,label:"5.5 weeks"},{unit:"mo",width:290,level:24,label:"7 weeks"},{unit:"mo",width:232,level:25,label:"2 months"},{unit:"mo",width:186,level:26,label:"2.5 months"},{unit:"mo",width:148,level:27,label:"3 months"},{unit:"mo",width:119,level:28,label:"4 months"},{unit:"mo",width:95,level:29,label:"5 months"},
{unit:"mo",width:76,level:30,label:"6 months"},{unit:"ye",width:723,level:31,label:"9 months"},{unit:"ye",width:573,level:32,label:"1 YEAR"},{unit:"ye",width:455,level:33,label:"1.25 years"},{unit:"ye",width:361,level:34,label:"1.5 years"},{unit:"ye",width:286,level:35,label:"2 years"},{unit:"ye",width:227,level:36,label:"2.5 years"},{unit:"ye",width:179,level:37,label:"3 years"},{unit:"ye",width:142,level:38,label:"4 years"},{unit:"ye",width:113,level:39,label:"5 years"},{unit:"ye",width:89,level:40,
label:"6 years"},{unit:"de",width:705,level:41,label:"8 years"},{unit:"de",width:559,level:42,label:"10 years"},{unit:"de",width:443,level:43,label:"13 years"},{unit:"de",width:302,level:44,label:"16 years"},{unit:"de",width:240,level:45,label:"20 years"},{unit:"de",width:190,level:46,label:"25 years"},{unit:"de",width:150,level:47,label:"30 years"},{unit:"de",width:120,level:48,label:"40 years"},{unit:"de",width:95,level:49,label:"50 years"},{unit:"de",width:76,level:50,label:"65 years"},{unit:"ce",
width:600,level:51,label:"80 years"},{unit:"ce",width:480,level:52,label:"100 years"},{unit:"ce",width:381,level:53,label:"130 years"},{unit:"ce",width:302,level:54,label:"160 years"},{unit:"ce",width:240,level:55,label:"200 years"},{unit:"ce",width:190,level:56,label:"250 years"},{unit:"ce",width:150,level:57,label:"300 years"},{unit:"ce",width:120,level:58,label:"400 years"},{unit:"ce",width:95,level:59,label:"500 years"},{unit:"ce",width:76,level:60,label:"600 years"},{unit:"thou",width:603,level:61,
label:"1000 years"},{unit:"thou",width:478,level:62,label:"1200 years"},{unit:"thou",width:379,level:63,label:"1800 years"},{unit:"thou",width:301,level:64,label:"160 years"},{unit:"thou",width:239,level:65,label:"xxx years"},{unit:"thou",width:190,level:66,label:"xxx years"},{unit:"thou",width:150,level:67,label:"xxx years"},{unit:"thou",width:120,level:68,label:"xxx years"},{unit:"thou",width:95,level:69,label:"8,000 years"},{unit:"thou",width:76,level:70,label:"10,000 years"},{unit:"tenthou",width:603,
level:71,label:"15,000 years"},{unit:"tenthou",width:358,level:72,label:"20,000 years"},{unit:"tenthou",width:213,level:73,label:"30,000 years"},{unit:"tenthou",width:126,level:74,label:"60,000 years"},{unit:"tenthou",width:76,level:75,label:"100,000 years"},{unit:"hundredthou",width:603,level:76,label:"180,000 years"},{unit:"hundredthou",width:358,level:77,label:"300,000 years"},{unit:"hundredthou",width:213,level:78,label:"500,000 years"},{unit:"hundredthou",width:126,level:79,label:"800,000 years"},
{unit:"hundredthou",width:76,level:80,label:"1 million years"},{unit:"mill",width:603,level:81,label:"1.2 million years"},{unit:"mill",width:358,level:82,label:"2 million years"},{unit:"mill",width:213,level:83,label:"3 million years"},{unit:"mill",width:126,level:84,label:"5 million years"},{unit:"mill",width:76,level:85,label:"10 million years"},{unit:"tenmill",width:603,level:86,label:"15 million years"},{unit:"tenmill",width:358,level:87,label:"30 million years"},{unit:"tenmill",width:213,level:88,
label:"50 million years"},{unit:"tenmill",width:126,level:89,label:"80 million years"},{unit:"tenmill",width:76,level:90,label:"100 million years"},{unit:"hundredmill",width:603,level:91,label:"120 million years"},{unit:"hundredmill",width:358,level:92,label:"200 million years"},{unit:"hundredmill",width:213,level:93,label:"300 million years"},{unit:"hundredmill",width:126,level:94,label:"500 million years"},{unit:"hundredmill",width:76,level:95,label:"1 billion years"},{unit:"bill",width:603,level:96,
label:"15 million years"},{unit:"bill",width:358,level:97,label:"30 million years"},{unit:"bill",width:213,level:98,label:"50 million years"},{unit:"bill",width:126,level:99,label:"80 million years"},{unit:"bill",width:76,level:100,label:"100 billion years"}];q.calculateSecPerPx=function(d){for(var j=1;j<d.length;j++){var n=d[j],A=0;switch(n.unit){case "da":A=86400;break;case "mo":A=2419200;break;case "ye":A=31536E3;break;case "de":A=31536E4;break;case "ce":A=31536E5;break;case "thou":A=31536E6;break;
case "tenthou":A=31536E7;break;case "hundredthou":A=31536E8;break;case "mill":A=31536E9;break;case "tenmill":A=31536E10;break;case "hundredmill":A=31536E11;break;case "bill":A=31536E12}n.spp=A/parseInt(n.width)}}(q.zoomTree);q.getStringWidth=function(d){if(d)return f("#timeglider-measure-span").html(d).width()};String.prototype.removeWhitespace=function(){return this.replace(RegExp("\\n","g"),"")};if(debug)debug.trace=function(d,j){f("#"+j).text(d)};q.googleMapsInit=function(){};q.googleMapsLoaded=
false;q.googleMapsLoad=function(){if(q.googleMapsLoaded==false){var d=document.createElement("script");d.type="text/javascript";d.src="http://maps.googleapis.com/maps/api/js?sensor=false&callback=timeglider.googleMapsInit";document.body.appendChild(d);q.googleMapsLoaded=true}}})(timeglider);(function(q){var F={},B=q.TG_Date,o={},G=jQuery,y={};q.TG_Mediator=function(v,u){this.options=o=v;y=u;this._focusDate={};this._zoomInfo={};this._zoomLevel=1;this.ticksReady=false;this.ticksArray=[];this.startSec=0;this.activeTimelines=[];this.max_zoom=o.max_zoom;this.min_zoom=o.min_zoom;this.icon_folder=q.icon_folder=o.icon_folder||"js/timeglider/icons/";this.timeOffset=B.getTimeOffset(o.timezone);this.fixed_zoom=this.max_zoom==this.min_zoom?true:false;this.gesturing=false;this.gestureStartScale=
this.gestureStartZoom=0;this.filters={include:"",exclude:"",legend:[]};this.timelineCollection=new q.TG_TimelineCollection;this.eventCollection=new q.TG_EventCollection;this.imagesToSize=this.imagesSized=0;this.timelineDataLoaded=false;this.initial_timeline_id=o.initial_timeline_id||"";this.sole_timeline_id="";this.dimensions={};this.focusedEvent="";if(o.max_zoom===o.min_zoom)this.fixed_zoom=o.min_zoom;if(o.main_map){this.main_map=o.main_map;timeglider.mapping.setMap(this.main_map,this)}F=this};q.TG_Mediator.prototype=
{focusToEvent:function(v){this.focusedEvent=v;this.setFocusDate(v.startdateObj);G.publish("mediator.focusToEvent")},gotoDateZoom:function(v,u){var f=false;this.setFocusDate(new B(v));if(u)f=this.setZoomLevel(u);if(!u||f==false)this.refresh()},zoom:function(v){this.setZoomLevel(this.getZoomLevel()+parseInt(v))},getScope:function(){var v=this.getZoomInfo(),u=this.getFocusDate(),f=this.getActiveTimelinesBounds();return{spp:Math.round(v.spp),width:this.dimensions.container.width,focusDateSec:Math.round(u.sec),
timelines:this.activeTimelines,timelineBounds:f,container:y}},getActiveTimelinesBounds:function(){for(var v=this.activeTimelines,u={},f=99999999999,D=0,z=0;z<v.length;z++){u=this.timelineCollection.get(v[z]);f=u.get("bounds").first<f?u.get("bounds").first:f;D=u.get("bounds").last>D?u.get("bounds").last:D}return{first:f,last:D}},loadTimelineData:function(v){var u=this;if(v)if(typeof v==="object")u.parseTimelineData(v);else if(v.substr(0,1)=="#"){v=[u.getTableTimelineData(v)];u.parseTimelineData(v)}else G.getJSON(v,
function(f){u.parseTimelineData(f)});else{this.timelineDataLoaded=true;this.setZoomLevel(Math.floor((this.max_zoom+this.min_zoom)/2));this.tryLoading()}},mapMarkerClick:function(v){this.focusToEvent(v)},getTimelineCollection:function(){return this.timelineCollection},timelineTitleClick:function(v){G.publish("mediator.timelineTitleClick",{timeline_id:v})},getTableTimelineData:function(v){var u={},f=0,D=[],z,e,p="",r=G(v);u.id=v.substr(1);u.title=r.attr("title")||"untitled";u.description=r.attr("description")||
"";u.focus_date=r.attr("focus_date")||B.getToday;u.initial_zoom=r.attr("initial_zoom")||20;u.events=[];r.find("tr").each(function(C){var d=G(this).children(),j;if(C===0)D=d.map(function(){return G(this).attr("class").replace(/^.*?\btg-(\S+)\b.*?$/,"$1")}).get();else{j={};d.each(function(n){z=D[n];e=z=="description"?G(this).html():G(this).text();j[z]=e});p="ev_"+f++;j.id=p;u.events.push(j)}});r.css("display","none");return u},parseTimelineData:function(v){var u=0,f=v.length,D={};D={};for(var z=0;z<
f;z++){D=v[z];D.mediator=this;D=(new q.TG_Timeline(D)).toJSON();if(D.id.length>0){u++;this.swallowTimeline(D)}}if(u===0)alert("ERROR loading data: Check JSON with jsonLint");else{this.timelineDataLoaded=true;this.tryLoading()}},tryLoading:function(){var v=this.timelineDataLoaded==true;if(this.imagesSized==this.imagesToSize&&v){this.setInitialTimelines();G.publish("mediator.timelineDataLoaded")}},swallowTimeline:function(v){this.sole_timeline_id=v.id;this.timelineCollection.add(v);G.publish("mediator.timelineListChangeSignal")},
setInitialTimelines:function(){var v=this,u=this.initial_timeline_id,f="";if(typeof u=="object"){f=this.initial_timeline_id[0];_.each(u,function(D){v.activeTimelines.push(D)})}else if(u.length>0){f=this.initial_timeline_id||this.sole_timeline_id;v.activeTimelines=[f]}else if(this.timelineCollection.length>0){f=this.timelineCollection.pluck("id")[0];v.activeTimelines=[f]}if(timeglider.mode=="authoring")v.setZoomLevel(40);else f?setTimeout(function(){var D=v.timelineCollection.get(f),z=D.get("focusDateObj");
v.setFocusDate(z);debug.log("focus date of loaded timeline:",z);v.setZoomLevel(D.get("initial_zoom"))},1E3):v.setZoomLevel(40)},refresh:function(){this.startSec=this._focusDate.sec;G.publish("mediator.refreshSignal")},setTicksReady:function(v){this.ticksReady=v;v===true&&G.publish("mediator.ticksReadySignal")},setTimeoffset:function(v){this.timeOffset=B.getTimeOffset(v);this.refresh()},getTimeoffset:function(){return this.timeOffset},setDimensions:function(v){this.dimensions=v},setFocusDate:function(v){if(v!=
this._focusDate)this._focusDate=v},getFocusDate:function(){return this._focusDate},getZoomLevel:function(){return parseInt(this._zoomLevel)},setZoomLevel:function(v){if(v<=this.max_zoom&&v>=this.min_zoom){this.startSec=this._focusDate.sec;if(v!=this._zoomLevel){this._zoomLevel=v;this._zoomInfo=q.zoomTree[v];G.publish("mediator.zoomLevelChange");G.publish("mediator.scopeChange");return true}else return false}else return false},getZoomInfo:function(){return this._zoomInfo},registerUIEvent:function(v){switch(v.name){case "dblclick":v=
v.event.pageX-v.dimensions.container.offset.left-v.dimensions.container.width/2;var u=this.getZoomInfo().spp,f=this.getFocusDate().sec;v=new B(Math.floor(f+v*u));G.publish("mediator.dblclick",{date:v})}},setFilters:function(v){switch(v.origin){case "clude":this.filters.include=v.include;this.filters.exclude=v.exclude;break;case "legend":var u=v.icon.replace(this.options.icon_folder,"");if(u=="all"){this.filters.legend=[];G.publish("mediator.legendAll")}else if(G.inArray(u,this.filters.legend)==-1)this.filters.legend.push(u);
else{v=[];v=G.grep(this.filters.legend,function(f){return f!=u});this.filters.legend=v}}G.publish("mediator.filtersChange");G.publish("mediator.scopeChange");this.refresh()},getTicksOffset:function(){return this._ticksOffset},setTicksOffset:function(v){this._ticksOffset=v;G.publish("mediator.ticksOffsetChange");G.publish("mediator.scopeChange")},getTickBySerial:function(v){for(var u=this.ticksArray,f=u.length,D=0;D<f;D++){var z=u[D];if(z.serial==v)return z}return false},addToTicksArray:function(v,
u){if(v.type=="init"){v.serial=B.getTimeUnitSerial(u,v.unit);this.ticksArray=[v]}else if(v.type=="l"){v.serial=this.ticksArray[0].serial-1;this.ticksArray.unshift(v)}else{v.serial=this.ticksArray[this.ticksArray.length-1].serial+1;this.ticksArray.push(v)}G.publish("mediator.ticksArrayChange");return v.serial},toggleTimeline:function(v){var u=this.timelineCollection.get(v).attributes,f=G.inArray(v,this.activeTimelines);if(f==-1){this.activeTimelines.push(v);this.setFocusDate(new B(u.focus_date));this.setZoomLevel(u.initial_zoom)}else{this.activeTimelines.splice(f,
1);this.refresh()}G.publish("mediator.activeTimelinesChange")},reportImageSize:function(v){var u=F.eventCollection.get(v.id);if(u.has("image")){if(v.error){u.attributes.image={};debug.log("WHOOPS: MISSING IMAGE: "+v.src)}else{u.attributes.image.width=v.width;u.attributes.image.height=v.height}this.imagesSized++;this.imagesSized==this.imagesToSize&&this.tryLoading()}}};q.getLowHigh=function(v){v=_.sortBy(v,function(u){return parseInt(u)});return{low:_.first(v),high:_.last(v)}};q.validateOptions=function(v){this.optionsMaster=
{initial_focus:{type:"date"},timezone:{type:"timezone"},editor:{type:"string"},backgroundColor:{type:"color"},backgroundImage:{type:"color"},min_zoom:{type:"number",min:1,max:100},max_zoom:{type:"number",min:1,max:100},initial_zoom:{type:"number",min:1,max:100},show_centerline:{type:"boolean"},display_zoom_level:{type:"boolean"},data_source:{type:"url"},basic_fontsize:{type:"number",min:9,max:100},mouse_wheel:{type:"string",possible:["zoom","pan"]},initial_timeline_id:{type:"mixed"},icon_folder:{type:"string"},
show_footer:{type:"boolean"},display_zoom_level:{type:"boolean"},event_modal:{type:"object"},event_overflow:{type:"string"}};var u=this,f="";G.each(v,function(D,z){if(u.optionsMaster[D])switch(u.optionsMaster[D].type){case "string":if(typeof z!="string")f+=D+" needs to be a string.\n";if(u.optionsMaster[D].possible)if(G.inArray(z,u.optionsMaster[D].possible)==-1)f+=D+" must be: "+u.optionsMaster[D].possible.join(" or ");break;case "number":if(typeof z!="number")f+=z+" needs to be a number.\n";if(u.optionsMaster[D].min)if(z<
u.optionsMaster[D].min)f+=D+" must be greater than or equal to "+u.optionsMaster[D].min+"\n";if(u.optionsMaster[D].max)if(z>u.optionsMaster[D].max)f+=D+" must be less than or equal to "+u.optionsMaster[D].max+"\n";break;case "timezone":var e=/[+|-]?[0-9]+:[0-9]+/;if(G.inArray(z,["New York","Denver","Chicago","Los Angeles"])==-1&&z.match(e)==-1)f+="The timezone is not formatted properly";break;case "boolean":if(typeof z!="boolean")f+=z+" needs to be a number.\n"}});return f}})(timeglider);(function(q){var F,B,o=timeglider,G=timeglider.TG_Date;q.widget("timeglider.timeline",{options:{timezone:"00:00",initial_focus:o.TG_Date.getToday(),editor:"none",min_zoom:1,max_zoom:100,show_centerline:true,data_source:"",culture:"en",basic_fontsize:12,mouse_wheel:"zoom",initial_timeline_id:"",icon_folder:"js/timeglider/icons/",show_footer:true,display_zoom_level:true,event_modal:{href:"",type:"default"},event_overflow:"plus"},_create:function(){this._id=q(this.element).attr("id");this.element.html("<div class='timeglider-container'><div class='timeglider-loading'>loading</div><div class='timeglider-centerline'></div><div class='timeglider-date-display'></div><div class='timeglider-truck' id='tg-truck'><div class='timeglider-ticks'><div class='timeglider-handle'></div></div></div><div class='timeglider-slider-container'><div class='timeglider-slider'></div><div class='timeglider-pan-buttons'><div class='timeglider-pan-left'></div><div class='timeglider-pan-right'></div></div></div><div class='timeglider-footer'><div class='timeglider-logo'></div><div class='timeglider-footer-button timeglider-filter-bt'></div><div class='timeglider-footer-button timeglider-settings-bt'></div><div class='timeglider-footer-button timeglider-list-bt'></div></div><div class='timeglider-event-hover-info'></div></div><span id='timeglider-measure-span'></span>")},
_init:function(){var y=timeglider.validateOptions(this.options);if(y==""){o.TG_Date.setCulture(this.options.culture);B=new o.TG_Mediator(this.options,this.element);F=new o.TG_PlayerView(this,B);B.setFocusDate(new G(this.options.initial_focus));B.loadTimelineData(this.options.data_source)}else alert("Rats. There's a problem with your widget settings:"+y)},goTo:function(y,v){B.gotoDateZoom(y,v)},resize:function(){F.resize()},getMediator:function(){return B},getScope:function(){return B.getScope()},
zoom:function(y){switch(y){case "in":y=-1;break;case "out":y=1}if(y>99||y<-99)return false;B.zoom(y)},load:function(y){B.loadTimelineData(y)},panButton:function(y,v){var u=0;switch(v){case "left":u=30;break;case "right":u=-30;break;default:u=v}F.setPanButton(y,u)},destroy:function(){q.Widget.prototype.destroy.apply(this,arguments);q(this.element).html("")}})})(jQuery);
